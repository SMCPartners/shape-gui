<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../elements/elements.html">
<style>
    :host close{
    width: 50%;
    margin: 0 auto;
    }

    #errorHTTP {
    height: 50%;
    margin: 0 auto;
    }

</style>
<dom-module id="measures-ctrl">
    <style></style>
    <template>
        <!--paper-dialog id='errorHTTP'>I got a 403</paper-dialog -->
        <paper-dialog id='errorHTTP' class="size-position">
            <span>{{errorText}}</span>
            <paper-button class="close" on-tap="retry">Retry</paper-button>
        </paper-dialog>
    </template>
</dom-module>
<script>
    (function () {
        Polymer({
            is: 'measures-ctrl',

            properties: {
                errorText: {
                    type: String,
                    value: ""
                },
                ajaxHandler: {
                    type: Object
                }
            },
            onError: function(request,error){
                errorHTTP.open();
            },
            retry: function() {
                errorHTTP.toggle();
                this.ajaxHandler.url = "http://jsonplaceholder.typicode.com/posts/";
                this.ajaxHandler.generateRequest();
            },
            // API functions
            index: function() {
                this.ajaxHandler.url = "http://jsonplaceholder.typicode.com/posts/breakthis";
                this.ajaxHandler.method = "GET";
                this.ajaxHandler.handleError = this.onError;
                this.ajaxHandler.generateRequest();
            },
            show: function(){
                if(id != null){
                    this.$.ajaxHandler.url = "/measures/show/" + String(id);
                    this.ajaxHandler.handleError = this.onError;
                    this.$.ajaxHandler.generateRequest();
                } else {
                    return null;
                }
            }
        });
    })();
</script>

<!--
To use in components, you need:

1. iron ajax component
    <iron-ajax auto id='ajaxHandler' on-response="setAttributes" on-error="onError" handle-as="json"> </iron-ajax>

2. providers-ctrl component
    <providers-ctrl id="ctrl"></providers-ctrl>

3. function to be called on component load, to set the ajax handler and start the ajax requests
    setCall: function() {
        var ctrl = this.$.ctrl;
        var ajax = this.$.ajax;

        ctrl.ajaxHandler = ajax;
        ctrl.index();
    }

4. function to set response handler in parent component
    setAttributes: function(request) {
        this.attribute = request.detail.response;
    }
4. function in the parent component for error handling
    onError: function(request,error) {
        var ctrl = this.$.ctrl;
        ctrl.errorText = error.error.message;
        ctrl.onError();
    }
-->