<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../elements.html">

<dom-module id="app-admin-panel-organization">
    <style>
        .pms {
        @apply(--pm-style)
        };

        th {
        text-align: center;
        background-color: #0066FF;
        color: white;
        border-right: 1px solid #808080;
        border-bottom: 1px solid #808080;
        font-weight: bold;
        };

        th, td {
          padding: 10px 15px;

          -webkit-user-select: none;   /*these make it so that text is not selectable*/
          -khtml-user-select: none;
          -moz-user-select: none;
          user-select: none;
          font-family: Roboto;

        };

        thead {
        background: #395870;
        color: #fff;
        };

        td {
        border-bottom: 1px solid #cecfd5;
        border-right: 1px solid #cecfd5;
        border-left: 1px solid #cecfd5;
        };
/*
        td: first-child {
        border-left: 1px solid #cecfd5;
        };

        tr: nth-child(even) {
        background-color: #395870;
        };*/

        table {
        border-collapse: separate;
        border-spacing: 0;
        };

        .flex-item {
        order: 0;
        flex: 1 1 auto;
        align-self: auto;
        }

        .noWrap {
          white-space: nowrap;
        }

    </style>
    <template>
        <div style="padding: 0 0.4em; display: flex;" class='flex-container'>
            <div class="flex-item"><input type="text" value="{{filterVal::input}}" data-table="order-table" placeholder="Search" style="height: 2em; margin: 0.5em 0.4em;"></div>
            <!--
            <div class="flex-item" style="height: 2em; margin: 0 25%; padding-top:0.5em;">
                <label>Sort By:</label>
                <select value="{{sortVal::change}}">
                    <option>Select:</option>
                    <option value="name">Name</option>
                    <option value="address">Address</option>
                </select>
            </div>
            -->
            <div class="flex-item">
                <paper-button raised on-tap="addOrganization" modalName="addOrganization" style="float:right;padding-top: 0.1em;">Add Organization</paper-button>
            </div>
        </div>
        <table class="order-table table-rows" style="width: 100%; padding: 0 0.4em;">
            <!-- <colgroup>
                <col span="2" style="width:40%">
                <col span="1" style="width:10%">
                <col span="1" style="width:40%">
            </colgroup> -->
            <thead>
                <th sortingGroup="name" on-tap="selectFunction">Name</th>
                <th sortingGroup="address" on-tap="selectFunction">Address</th>
                <th sortingGroup="primaryContactPhone" on-tap="selectFunction">Primary Contact Phone</th>
                <th sortingGroup="primaryContactName" on-tap="selectFunction">Primary Contact Name</th>
                <th sortingGroup="primaryContactEmail" on-tap="selectFunction">Primary Contact Email</th>
                <th sortingGroup= "primaryContactRole" on-tap="selectFunction">Primary Contact Role</th>
                <th></th>
            </thead>
            <tbody>
            <template is="dom-repeat" items="{{organization}}" filter="{{_filter(filterVal)}}" sort="{{_sort(sortVal)}}">
                <tr>
                    <td><span>{{item.name}}</span></td>
                    <td><span>{{item.address}}</span></td>
                    <td><span class="noWrap">{{item.primaryContactPhone}}</span></td>
                    <td><span class="noWrap">{{item.primaryContactName}}</span></td>
                    <td><span>{{item.primaryContactEmail}}</span></td>
                    <td><span>{{item.primaryContactRole}}</span></td>
                    <td style="font-size: 12px">
                        <div class="editButton">
                            <paper-button raised on-tap="editOrganization" modalName="editOrganization">Edit</paper-button>
                        </div>
                    </td>
                </tr>
            </template>
                <app-admin-add id="inputModal"></app-admin-add>
                <app-admin-edit id="editModal"></app-admin-edit>
            </tbody>
        </table>
    </template>
</dom-module>
<script>
    (function() {
    Polymer({
            is: 'app-admin-panel-organization',
            properties: {
            name: String,
            address: String,
            },

            ready: function() {
            this.organization=[
              {
                name: 'Prohealth',
                address: '1234 Hartford Rd',
                primaryContactPhone: '860-216-5245',
                primaryContactName: 'John Doe',
                primaryContactEmail: 'jburlette@gmail.com',
                primaryContactRole: 'Director'
              },
              {
                name: 'Hartford',
                address: '9999 Columbus Blvd Mexico City, Mexico',
                primaryContactPhone: '860-659-4856',
                primaryContactName: 'Oliver Twist',
                primaryContactEmail: 'ojonston@gmail.com',
                primaryContactRole: 'CEO'
              },
              {
                name: 'EHealth Physicians',
                address: '25 Oak Rd Hartford, CT 06116',
                primaryContactPhone: '203-256-6344',
                primaryContactName: 'Dr. Feelgood',
                primaryContactEmail: 'drgood@gmail.com',
                primaryContactRole: 'Head Administrator'
              },
              {
                name: 'Physicians Anonymous',
                address: '1234 Hartford Rd Middletown, CT 06457',
                primaryContactPhone: '416-205-7894',
                primaryContactName: 'Pablo Picasso',
                primaryContactEmail: 'pPicaso84@gmail.com',
                primaryContactRole: 'Head Artist'
              }
            ];
            },

            _filter: function(val) {
                return function(organization) {
                    if (!val) return true;
                    if (!organization) return false;
                    return (organization.name && ~organization.name.toLowerCase().indexOf(val.toLowerCase())) ||
                            (organization.address && ~organization.address.toLowerCase().indexOf(val.toLowerCase()));
               };
            },

            selectFunction: function(e) {
              val = e.target.getAttribute('sortinggroup');  //this allows the function to retreive the 'sortingGroup' attribute from the clicked button.
              this.sortPass = val;
              console.log("target click: " + val);
              console.log("lastSortVal is " + this.lastSortVal);

              if (val === this.lastSortVal) {    //sortJim is a toggle that makes sure that rows do not stay in reverse
                  this.sortReverse = true;
                  this.sortVal = val.toUpperCase();
                  this.lastSortVal = val.toUpperCase;
                  }
              else
                {
                  this.sortReverse = false;
                  this.sortVal = val;
                  this.lastSortVal = val;

                };



              },

            _sort: function(val) {
                  var clicked = this.sortPass;
                  console.log("sortReverse is " + this.sortReverse)
                  if (this.sortReverse) {
                            return function(a, b) {
                            if (a[clicked].toLowerCase() === b[clicked].toLowerCase()) return 0;
                            return a[clicked].toLowerCase() < b[clicked].toLowerCase() ? 1 : -1;
                          }
                      }

                      else {
                            return function(a, b) {
                            if (a[clicked].toLowerCase() === b[clicked].toLowerCase()) return 0;
                            return a[clicked].toLowerCase() < b[clicked].toLowerCase() ? -1 : 1;
                      };
                    }
             },

            editOrganization: function(e) {
                this.$.editModal.editButton(e.target.parentNode.getAttribute("modalName"));
            },

            addOrganization: function(e) {
                this.$.inputModal.addButton(e.target.parentNode.getAttribute("modalName"));
            },

           logOrganization: function (e) {
                var formSubmitEditOrganization = {
                    firstName: firstName.value,
                    lastName: lastName.value,
                    NPI: NPI.value,
                    organization: organization.value
                };gre
                this.$.editOrganizationInfo.toggle();
            }
        });
})();
</script>
