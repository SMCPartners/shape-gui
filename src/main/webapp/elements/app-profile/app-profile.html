<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../elements.html">

<dom-module id="app-profile">
  <style>
      paper-input {
        width: 65px;
        margin-right: 5px;
        display: inline-block;

        --paper-input-container-disabled: {
          opacity: 1;
          font-weight: 600;
        }
      }

      h1 {
        padding-top: 25px;
      }
      paper-button {
        padding: 10px;
      }
      title {
        margin-left: auto;
        margin-right: auto;
      }
      .fab {
          position: fixed;
          z-index: 10;
          top: 180px;
          right: 5%;
      }
      .firstColumn {
        width: 40%;
        display: inline-block;
        margin-left: 15%;
        vertical-align: top;

      }
      .demoColumn {
        width: 40%;
        display: inline-block;
      }

      .columnHeader {
        margin-left: auto;
        margin-right: auto;
      }
      p {
        display: inline-block;
        margin-right: 10px;
      }
      .orginfo {
        margin-left: auto;
        margin-right: auto;
        width: 70%
      }
      .address {
        width: 35%;
        display: inline-block;
        margin-left: 15%;


      }
      .primaryContact{
        width: 35%;
        display: inline-block;
      }
      .center {
        text-align: center;
      }
      .smallFont {
        font-size: .75em;
        margin-right: 25px;
      }
      .inputBlock {
        display: inline-block;
      }


  </style>
  <template>
      <shape-iron-ajax-helper
          id="findStratByOrg"
          method="GET"
          resource=""
          handle-as="json"
          on-response="callBack"
          on-error="addNewStrat"
          debounce-duration="300">
      </shape-iron-ajax-helper>
      <shape-iron-ajax-helper
          id="postOrgStrat"
          method="POST"
          resource="/common/organization_stratification/edit/"
          handle-as="json"
          debounce-duration="300"
          on-response="setajax">
      </shape-iron-ajax-helper>
      <shape-iron-ajax-helper
          id="addOrgStrat"
          method="POST"
          resource="/common/organization_stratification/add/"
          handle-as="json"
          debounce-duration="300"
          on-response="setajax">
      </shape-iron-ajax-helper>

        <paper-material elevation="3">
        <h1 class="center">{{orgData.name}}</h1>
        <div class="orginfo">
          <div class="address">
          <h3 class="center">Address:<h3>
          <h3 class="center">{{orgData.addressStreet}}<h3>
            <h3 class="center"><span>{{orgData.addressCity}}</span>,&nbsp<span>{{orgData.addressState}}</span>&nbsp<span>{{orgData.addressZip}}</span><h3>
              <h3 class="center">{{orgData.primaryContactPhone}}<h3>
        </div>
        <div class="primaryContact">
          <h3 class="center">Primary Contact</h3>
          <h3 class="center">{{orgData.primaryContactName}}</h3>
          <h3 class="center">{{orgData.primaryContactRole}}</h3>
          <h3 class="center">{{orgData.primaryContactEmail}}</h3>

        </div>
      </div>
      <!-- <p>{{isDemographicData}}</p>
      <p>{{disabled}}</p> -->
      <template is="dom-if" if="{{isDemographicData}}">
        <div class="lowerHalf">
          <h1 class="center">Patient Population</h1>
            <div class="firstColumn">
              <h3 class="center">Patient Volume</h3>
              <div class="inputBlock">
                <paper-input value="{{profile.totalPatients}}" disabled="{{disabled}}"></paper-input><p class="smallFont">Patients</p>
              </div>
              <div class="inputBlock">
                <paper-input value="{{profile.totalVisits}}" disabled="{{disabled}}"></paper-input><p class="smallFont">Visits per Year</p>
              </div>
              <h3 class="center">Patient Counts</h3>
              <div class="inputBlock">
                <paper-input value="{{profile.patientsHypertension}}" disabled="{{disabled}}"></paper-input><p class="smallFont">Patients with a Diagnosis of Hypertension</p>
              </div>
              <div class="inputBlock">
                <paper-input value="{{profile.patientsDiabetes}}" disabled="{{disabled}}"></paper-input><p class="smallFont">Patients with a Diagnosis of Diabetes</p>
              </div>
              <div class="inputBlock">
                <paper-input value="{{profile.patientsPreDiabetes}}" disabled="{{disabled}}"></paper-input><p class="smallFont">Patients with Pre-Diabetes</p>
              </div>
              <div class="inputBlock">
                <paper-input value="{{profile.patientsHighBp}}" disabled="{{disabled}}"></paper-input><p class="smallFont">Patients with High BP but no Diagnosis of Hypertension</p>
              </div>
            </div>
            <div class="demoColumn">

                <h3 class="center">Demographic Information</h3>

            <h3>Gender</h3>
                <template id="genderlist" is="dom-repeat" items="{{gender}}" as="gender">
                  <div class="inputBlock">
                      <paper-input value="{{gender.num}}" disabled="{{disabled}}"></paper-input><p class="smallFont">{{gender.strat}}</p>
                  </div>
                </template>
            <h3>Age</h3>
                <template id="agelist" is="dom-repeat" items="{{age}}" as="age">
                  <div class="inputBlock">
                      <paper-input value="{{age.num}}" disabled="{{disabled}}"></paper-input><p class="smallFont">{{age.strat}}</p>
                  </div>
                </template>
            <h3>Ethnicity</h3>
                <template id="ethnicitylist" is="dom-repeat" items="{{ethnicity}}" as="ethnicity">
                  <div class="inputBlock">
                      <paper-input value="{{ethnicity.num}}" disabled="{{disabled}}"></paper-input><p class="smallFont">{{ethnicity.strat}}</p>
                  </div>
                </template>
            <h3>Race</h3>
                <template id="racelist" is="dom-repeat" items="{{race}}" as="race">
                  <div class="inputBlock">
                      <paper-input value="{{race.num}}" disabled="{{disabled}}"></paper-input><p class="smallFont">{{race.strat}}</p>
                  </div>
                </template>

            </div>
          </div>
      <div class="center">
        <paper-button on-tap="editProfile" raised="2">{{profButton}}</paper-button>
        <paper-button on-tap="cancelEdit" raised="2">Cancel</paper-button>
      </div>
      </paper-material>
    </template>
    <template is="dom-if" if="{{!isDemographicData}}" restamp="true" id="newProfile">

              <div class="lowerHalf">
                <h1 class="center">Add Patient Population Information</h1>
                  <div class="firstColumn">
                    <h3 class="center">Patient Volume</h3>
                    <div class="inputBlock">
                      <paper-input id='totalPatients'></paper-input><p class="smallFont">Patients</p>
                    </div>
                    <div class="inputBlock">
                      <paper-input id="totalVisits"></paper-input><p class="smallFont">Visits per Year</p>
                    </div>
                    <h3 class="center">Patient Counts</h3>
                    <div class="inputBlock">
                      <paper-input id="patientsHypertension"></paper-input><p class="smallFont">Patients with a Diagnosis of Hypertension</p>
                    </div>
                    <div class="inputBlock">
                      <paper-input id="patientsDiabetes"></paper-input><p class="smallFont">Patients with a Diagnosis of Diabetes</p>
                    </div>
                    <div id="testing" class="inputBlock">
                      <paper-input id="patientsPreDiabetes"></paper-input><p class="smallFont">Patients with Pre-Diabetes</p>
                    </div>
                    <div class="inputBlock">
                      <paper-input id="patientsHighBp"></paper-input><p class="smallFont">Patients with High BP but no Diagnosis of Hypertension</p>
                    </div>
                  </div>
                  <div class="demoColumn">

                      <h3 class="center">Demographic Information</h3>

                  <h3>Gender</h3>
                      <template id="genderlist" is="dom-repeat" items="{{gender}}" as="gender">
                        <div class="inputBlock">
                            <paper-input value="{{gender.num}}"></paper-input><p class="smallFont">{{gender.strat}}</p>
                        </div>
                      </template>
                  <h3>Age</h3>
                      <template id="agelist" is="dom-repeat" items="{{age}}" as="age">
                        <div class="inputBlock">
                            <paper-input value="{{age.num}}"></paper-input><p class="smallFont">{{age.strat}}</p>
                        </div>
                      </template>
                  <h3>Ethnicity</h3>
                      <template id="ethnicitylist" is="dom-repeat" items="{{ethnicity}}" as="ethnicity">
                        <div class="inputBlock">
                            <paper-input value="{{ethnicity.num}}"></paper-input><p class="smallFont">{{ethnicity.strat}}</p>
                        </div>
                      </template>
                  <h3>Race</h3>
                      <template id="racelist" is="dom-repeat" items="{{race}}" as="race">
                        <div class="inputBlock">
                            <paper-input value="{{race.num}}"></paper-input><p class="smallFont">{{race.strat}}</p>
                        </div>
                      </template>

                  </div>
                </div>
        <paper-button class="center" on-tap="setAjaxAddStrat" raised="2">Add</paper-button>


      </paper-material>

    </template>
    </template>

</dom-module>
<script>
    (function () {
        Polymer({
            is: 'app-profile',
            properties: {
              organizationID: String,
              //profile: Object,
              isDemographicData: Boolean
            },
            ready: function() {
                this.cityStateZip = 'Hartford, CT 06106';
                this.city = 'Hartford';
                this.state = 'CT';
                this.zip = '06106';
                this.profButton = 'Edit'
                this.disabled =true;
                this.profile = {
                  genderMale: 0,
                  genderFemale: 0,
                  genderOther: 0,
                  ageUnder17: 0,
                  age1844: 0,
                  age4564: 0,
                  ageOver65: 0,
                  ethnicityHispanicLatino: 0,
                  ethnicityNotHispanicLatino: 0,
                  raceAsian: 0,
                  raceAfricanAmerican: 0,
                  raceNativeHawaiian: 0,
                  raceAmericanIndian: 0,
                  raceWhite: 0,
                  raceOther: 0,
                  totalPatients: 0,
                  totalVisits: 0,
                  patientsHypertension: 0,
                  patientsPreDiabetes: 0,
                  patientsHighBp: 0,
                  patientsDiabetes: 0
                };



            },

            editProfile: function(e) {
                if (this.profButton == 'Save' && this.gender[0].strat !== "" ) {
                  console.log(this.profButton);
                  this.disabled = true;
                  this.setAjaxEditStrat();
                  this.profButton = 'Edit';
                }
                else {
                  console.log(this.profButton);
                  this.profButton = 'Save';
                  this.disabled = false;
                };
                var editInput = document.getElementsByClassName('childtwo');
                for(var i = 0; i < editInput.length; i++) {
                  this.disabled = false;
                };


            },
            cancelEdit: function (e) {
                  this.disabled = true;
                  this.profButton = 'Edit';
                  this.setajax();
            },
            setajax: function() {
              if (app.$.mainPage.$.dashboard.isOrgSelected){
                this.$.findStratByOrg.callBack = this.callBack
                this.$.findStratByOrg.resource = "/common/organization_stratification/findAllByOrg/"+ document.getElementById('findUserOrganizations').value;
                this.$.findStratByOrg.generateRequest();
              }

            },
            setAjaxAddStrat: function() {
              this.$.addOrgStrat.body = JSON.stringify({
                "id" : 0,
                "genderMale" : this.gender[0].num,
                "genderFemale" : this.gender[1].num,
                "genderOther" : this.gender[2].num,
                "ageUnder17" : this.age[0].num,
                "age1844" : this.age[1].num,
                "age4564" : this.age[2].num,
                "ageOver65" : this.age[3].num,
                "ethnicityHispanicLatino" : this.ethnicity[0].num,
                "ethnicityNotHispanicLatino" : this.ethnicity[1].num,
                "raceAfricanAmerican" : this.race[0].num,
                "raceAmericanIndian" : this.race[1].num,
                "raceAsian" : this.race[2].num,
                "raceNativeHawaiian" : this.race[3].num,
                "raceWhite" : this.race[4].num,
                "raceOther" : this.race[5].num,
                "organizationId" : app.$.mainPage.$.dashboard.$.findUserOrganizations.value,
                "userId" : app.$.loginPage.$.userIdInput.value,
                "rpDate" : "",
                "totalPatients" : this.$$('#totalPatients').value,
                "totalVisits" : this.$$('#totalVisits').value,
                "patientsHypertension" : this.$$('#patientsHypertension').value,
                "patientsDiabetes" : this.$$('#patientsDiabetes').value,
                "patientsPreDiabetes" : this.$$('#patientsPreDiabetes').value,
                "patientsHighBp" : this.$$('#patientsHighBp').value

               });
              this.$.addOrgStrat.generateRequest();
              this.isDemographicData = 1;
            },
            setAjaxEditStrat: function() {
              this.$.postOrgStrat.body = JSON.stringify({
                "id" : this.profile.id,
                "genderMale" : this.gender[0].num,
                "genderFemale" : this.gender[1].num,
                "genderOther" : this.gender[2].num,
                "ageUnder17" : this.age[0].num,
                "age1844" : this.age[1].num,
                "age4564" : this.age[2].num,
                "ageOver65" : this.age[3].num,
                "ethnicityHispanicLatino" : this.ethnicity[0].num,
                "ethnicityNotHispanicLatino" : this.ethnicity[1].num,
                "raceAfricanAmerican" : this.race[0].num,
                "raceAmericanIndian" : this.race[1].num,
                "raceAsian" : this.race[2].num,
                "raceNativeHawaiian" : this.race[3].num,
                "raceWhite" : this.race[4].num,
                "raceOther" : this.race[5].num,
                "organizationId" : app.$.mainPage.$.dashboard.$.findUserOrganizations.value,
                "userId" : app.$.loginPage.$.userIdInput.value,
                "rpDate" : this.profile.rpDate,
                "totalPatients" : this.profile.totalPatients,
                "totalVisits" : this.profile.totalVisits,
                "patientsHypertension" : this.profile.patientsHypertension,
                "patientsDiabetes" : this.profile.patientsDiabetes,
                "patientsPreDiabetes" : this.profile.patientsPreDiabetes,
                "patientsHighBp" : this.profile.patientsHighBp
               });
              console.log(this.$.postOrgStrat.body);
              this.$.postOrgStrat.generateRequest();
            },

           callBack: function(request) {
             this.profile = request.detail.response[0];
             console.log(this.profile);

             if(this.profile){
               this.isDemographicData = 1;
             }
             else{
               this.isDemographicData = 0;
               this.diasabled = false;
               //this.setProfile();
              //  this.set('gender',
              //  [{
              //      strat: 'Male',
              //      num: 0},
              //    {
              //      strat: 'Female',
              //      num: 'Female', num: 0},
              //    {
              //      strat: 'Other',
              //      num: 0 }
              //
              //  ]);
              //  this.set('age',
              //  [{
              //     strat: '17 & Under',
              //     num: 0},
              //  {
              //     strat: '18-44 Years',
              //     num: 0},
              //  {
              //     strat: '45-64 Years',
              //     num: 0},
              //  {
              //     strat: '65 & Over',
              //     num: 0}
              // ]);
              // this.set('ethnicity',
              // [{
              //   strat: 'Hispanic/Latino',
              //   num: 0},
              // {
              //   strat: 'Not Hispanic/Latino',
              //   num: 0}
              // ]);
              // this.set('race',
              // [{
              //   strat: 'African American/Black',
              //   num: 0},
              // {
              //   strat: 'American Indian or Alaska Native',
              //   num: 0},
              // {
              //   strat: 'Asian',
              //   num: 0},
              // {
              //   strat: 'Native Hawaiian or Pacific Islander',
              //   num: 0},
              // {
              //   strat: 'White',
              //   num: 0},
              // {
              //   strat: 'Other',
              //   num: 0}
              // ]);
             }

             this.set('gender',
             [{
                 strat: 'Male',
                 num: this.profile.genderMale},
               {
                 strat: 'Female',
                 num: 'Female', num: this.profile.genderFemale},
               {
                 strat: 'Other',
                 num: this.profile.genderOther}

             ]);
             console.log("Profile is: ", this.profile);
             this.set('age',
             [{
                strat: '17 & Under',
                num: this.profile.ageUnder17},
             {
                strat: '18-44 Years',
                num: this.profile.age1844},
             {
                strat: '45-64 Years',
                num: this.profile.age4564},
             {
                strat: '65 & Over',
                num: this.profile.ageOver65}
            ]);
            this.set('ethnicity',
            [{
              strat: 'Hispanic/Latino',
              num: this.profile.ethnicityHispanicLatino},
            {
              strat: 'Not Hispanic/Latino',
              num: this.profile.ethnicityNotHispanicLatino}

            ]);
            this.set('race',
            [{
              strat: 'African American/Black',
              num: this.profile.raceAfricanAmerican},
            {
              strat: 'American Indian or Alaska Native',
              num: this.profile.raceAmericanIndian},
            {
              strat: 'Asian',
              num: this.profile.raceAsian},
            {
              strat: 'Native Hawaiian or Pacific Islander',
              num: this.profile.raceNativeHawaiian},
            {
              strat: 'White',
              num: this.profile.raceWhite},
            {
              strat: 'Other',
              num: this.profile.raceOther}
            ]);
          },
          addNewStrat: function() {
              this.profbutton = "Add New Profile Data";
          },
          setProfile: function() {
            this.profile = {
              genderMale: 0,
              genderFemale: 0,
              genderOther: 0,
              ageUnder17: 0,
              age1844: 0,
              age4564: 0,
              ageOver65: 0,
              ethnicityHispanicLatino: 0,
              ethnicityNotHispanicLatino: 0,
              raceAsian: 0,
              raceAfricanAmerican: 0,
              raceNativeHawaiian: 0,
              raceAmericanIndian: 0,
              raceWhite: 0,
              raceOther: 0,
              totalPatients: 0,
              totalVisits: 0,
              patientsHypertension: 0,
              patientsPreDiabetes: 0,
              patientsHighBp: 0,
              patientsDiabetes: 0
            };
          }

        });
    })();

</script>
