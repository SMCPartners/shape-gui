<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../elements.html">


<dom-module id="app-profile">
    <style>
      paper-input {
        width: 120px;
        padding: 15px 5px 15px 5px;
        display: inline-block;
      };
      h1 {
        padding: 0px 0px 25px 50px;
      };
      paper-button {
        padding: 10px;
      };
      .fab {
          position: fixed;
          z-index: 10;
          top: 180px;
          right: 5%;
      };



    </style>
    <template>

      <shape-iron-ajax-helper
          id="findStratByOrg"
          method="GET"
          resource=""
          handle-as="json"
          on-response="callBack"
          on-error="addNewStrat"
          debounce-duration="300">
      </shape-iron-ajax-helper>
      <shape-iron-ajax-helper
          id="postOrgStrat"
          method="POST"
          resource="/common/organization_stratification/edit/"
          handle-as="json"
          debounce-duration="300">
      </shape-iron-ajax-helper>
      <shape-iron-ajax-helper
          id="addOrgStrat"
          method="POST"
          resource="/common/organization_stratification/add/"
          handle-as="json"
          debounce-duration="300">
      </shape-iron-ajax-helper>

      <!-- <div class="fab">
        <paper-fab icon="add" elevation="5" on-tap="addProfile" id="addFab"></paper-fab>
        <paper-tooltip for="addProfile" offset="3">Add New Demographic Profile</paper-tooltip>
      </div> -->

<!-- on-response="callBack" -->
        <paper-material elevation="5">
            <h1>Gender</h1>
                <template id="genderlist" is="dom-repeat" items="{{gender}}" as="gender">

                      <paper-input label="{{gender.strat}}" value="{{gender.num}}" disabled="{{disabled}}"></paper-input>

                </template>



        </paper-material>

        <paper-material elevation="5">
            <h1>Age</h1>
                <template id="agelist" is="dom-repeat" items="{{age}}" as="age">

                      <paper-input label="{{age.strat}}" value="{{age.num}}" disabled="{{disabled}}"></paper-input>

                </template>



        </paper-material>
        <paper-material elevation="5">
            <h1>Ethnicity</h1>
                <template id="ethnicitylist" is="dom-repeat" items="{{ethnicity}}" as="ethnicity">

                      <paper-input label="{{ethnicity.strat}}" value="{{ethnicity.num}}" disabled="{{disabled}}"></paper-input>

                </template>



        </paper-material>
        <paper-material elevation="5">
            <h1>Race</h1>
                <template id="racelist" is="dom-repeat" items="{{race}}" as="race">

                      <paper-input label="{{race.strat}}" value="{{race.num}}" disabled="{{disabled}}"></paper-input>

                </template>



        </paper-material>

        <paper-button on-tap="editProfile" raised="2">{{profButton}}</paper-button>

        <paper-button on-tap="cancelEdit" raised="2">Cancel</paper-button>

    </template>
</dom-module>
<script>
    (function () {
        Polymer({
            is: 'app-profile',
            properties: {
              organizationID: String,
              profile: Object
            },
            ready: function() {
                this.cityStateZip = 'Hartford, CT 06106';
                this.city = 'Hartford';
                this.state = 'CT';
                this.zip = '06106';
                this.profButton = 'Edit'
                this.disabled =true;

            },
            sortFunction: function (gender) {
              return 1;
            },
            editProfile: function(e) {
                if (this.profButton == 'Save' && this.gender[0].strat !== "" ) {
                    console.log(this.profButton);
                    this.disabled = true;
                    this.setAjaxEditStrat();
                    this.profButton = 'Edit';
                }
                else if (this.profbutton === "Save" && this.gender[0].strat === "") {
                  console.log(this.profButton);
                  this.setAjaxAddStrat();
                  this.disabled = true;
                }
                else {
                    console.log(this.profButton);
                    this.profButton = 'Save';
                };
                var editInput = document.getElementsByClassName('childtwo');
                for(var i = 0; i < editInput.length; i++) {
                    this.disabled = false;
                };

            },
            cancelEdit: function (e) {
                var cancelInput = document.getElementsByClassName('childtwo');
                for(var i = 0; i < cancelInput.length; i++) {
              this.disabled = true;
                };
                this.profButton = 'Edit';
            },
            setajax: function() {
              this.$.findStratByOrg.callBack = this.callBack
              this.$.findStratByOrg.resource = "/common/organization_stratification/findAllByOrg/"+ document.getElementById('findUserOrganizations').value;
              //console.log(this.$.findStratByOrg.resource);
              this.$.findStratByOrg.generateRequest();

            },
            setAjaxAddStrat: function() {
              this.$.addOrgStrat.body = JSON.stringify({
                "id" : "",
                "genderMale" : this.gender[0].num,
                "genderFemale" : this.gender[1].num,
                "genderOther" : this.gender[2].num,
                "ageUnder17" : this.age[0].num,
                "age1844" : this.age[1].num,
                "age4564" : this.age[2].num,
                "ageOver65" : this.age[3].num,
                "ethnicityHispanicLatino" : this.ethnicity[0].num,
                "ethnicityNotHispanicLatino" : this.ethnicity[1].num,
                "raceAfricanAmerican" : this.race[0].num,
                "raceAmericanIndian" : this.race[1].num,
                "raceAsian" : this.race[2].num,
                "raceNativeHawaiian" : this.race[3].num,
                "raceWhite" : this.race[4].num,
                "raceOther" : this.race[5].num,
                "organizationId" : app.$.mainPage.$.dashboard.$.findUserOrganizations.value,
                "userId" : app.$.loginPage.$.userIdInput.value,
                 "rpDate" : ""
               });
              this.$.addOrgStrat.generateRequest();
            },
            setAjaxEditStrat: function() {
              this.$.postOrgStrat.body = JSON.stringify({
                "id" : this.profile.id,
                "genderMale" : this.gender[0].num,
                "genderFemale" : this.gender[1].num,
                "genderOther" : this.gender[2].num,
                "ageUnder17" : this.age[0].num,
                "age1844" : this.age[1].num,
                "age4564" : this.age[2].num,
                "ageOver65" : this.age[3].num,
                "ethnicityHispanicLatino" : this.ethnicity[0].num,
                "ethnicityNotHispanicLatino" : this.ethnicity[1].num,
                "raceAfricanAmerican" : this.race[0].num,
                "raceAmericanIndian" : this.race[1].num,
                "raceAsian" : this.race[2].num,
                "raceNativeHawaiian" : this.race[3].num,
                "raceWhite" : this.race[4].num,
                "raceOther" : this.race[5].num,
                "organizationId" : app.$.mainPage.$.dashboard.$.findUserOrganizations.value,
                "userId" : app.$.loginPage.$.userIdInput.value,
               });
              this.$.postOrgStrat.generateRequest();
            },

          // callBackTest: function (){
          //   if (typeof request === 'undefined'){
          //     this.addProfile();
          //   }
          //   else {
          //     this.callback();
          //   }
          // },

           callBack: function(request) {
             //console.log(request.detail.response[0]);

             this.profile = request.detail.response[0];

             this.set('gender',
             [{
                 strat: 'Male',
                 num: this.profile.genderMale},
               {
                 strat: 'Female',
                 num: 'Female', num: this.profile.genderFemale},
               {
                 strat: 'Other',
                 num: this.profile.genderOther}

             ]);
             this.set('age',
             [{
                strat: '17 & Under',
                num: this.profile.ageUnder17},
             {
                strat: '18-44 Years',
                num: this.profile.age1844},
             {
                strat: '45-64 Years',
                num: this.profile.age4564},
             {
                strat: '65 & Over',
                num: this.profile.ageOver65}
            ]);
            this.set('ethnicity',
            [{
              strat: 'Hispanic/Latino',
              num: this.profile.ethnicityHispanicLatino},
            {
              strat: 'Not Hispanic/Latino',
              num: this.profile.ethnicityNotHispanicLatino},
            {
              strat: 'Other',
              num: 'null'}
            ]);
            this.set('race',
            [{
              strat: 'African American/Black',
              num: this.profile.raceAfricanAmerican},
            {
              strat: 'American Indian or Alaska Native',
              num: this.profile.raceAmericanIndian},
            {
              strat: 'Asian',
              num: this.profile.raceAsian},
            {
              strat: 'Native Hawaiian or Pacific Islander',
              num: this.profile.raceNativeHawaiian},
            {
              strat: 'White',
              num: this.profile.raceWhite},
            {
              strat: 'Other',
              num: this.profile.raceOther}
            ]);
          },
          addNewStrat: function() {
              this.profbutton = "Add New Profile Data";
          }
          // addProfile: function () {
          //
          // }

        });
    })();

</script>
