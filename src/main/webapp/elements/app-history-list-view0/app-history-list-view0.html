<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../elements.html">


<dom-module id="app-history-list-view">
    <style>
        .pms {
            @apply(--pm-style)
        };
        .child {
            order: 0;
            flex: 0 1 auto;
            align-self: center;
        };
        .parent {
            display: flex;
            flex-direction: row;
            flex-wrap: wrap;
            justify-content: space-around;
            align-content: space-between;
            align-items: flex-start;
        };
        .parenttwo {
            display: flex;
            flex-direction: row;
            flex-wrap: wrap;
            justify-content: center;
            align-content: space-between;
            align-items: flex-start;
        };
        .fraction1 {
            display: inline-block;
            position: relative;
            vertical-align: middle;
            letter-spacing: 0.001em;
            text-align: center;
            font-size: 20px;
        };
        .fraction2 {
            display: inline-block;
            position: relative;
            vertical-align: middle;
            letter-spacing: 0.001em;
            text-align: center;
            font-size: 40px;
        };
        .fraction1 > span {
            display: block;
            padding: 0.1em;
        };
        .fraction1 span.fdn {
            border-top: thin solid black;
        };
        .fraction1 span.bar {
            display: none;
        };
        .fraction2 > span {
            display: block;
            padding: 0.1em;
        };
        .fraction2 span.fdn {
            border-top: thin solid black;
        };
        .fraction2 span.bar {
            display: none;
        };
        .header {
            font-size: 36px;
        };
        .description {
            font-size: 20px;
            text-align: center;
            margin-left: 2em;
            margin-right: 2em;
            margin-top: 1em;
            margin-bottom: 1em;
        };
        .modalHeader {
            align: center;
        };
        .modalSection {
            font-size: 20px;
        };
        .leader {
            border-color: black;
        };
        .double {
            flex: 2 2;
        };
        .single {
            flex: 1 1;
        };
        .modalBox {
            position: fixed;
            width: 70%;
            height: 70%;
            top: 0;
            right: 0;
            bottom: auto;
            left: 0;
            margin: 0px !important;
        };
        .fab {
            position: fixed;
            z-index: 10;
            bottom: 5%;
            right: 5%;
        };
        #measureChart {
            margin-top: 1em;
            height: 80%
        };
        paper-dialog-scrollable {
          height: auto;

        }
        paper-tooltip {

          padding-right: 10px;
          padding-bottom: 10px;
          float: left;

        }
    </style>
    <template>

      <shape-iron-ajax-helper
        id="findMeasureInput"
        resource=""
        handle-as="json"
        on-response="callBack"
        debounce-duration="300">
      </shape-iron-ajax-helper>
      <shape-iron-ajax-helper
        id="findMeasureByOrg"
        resource="/admin/find/measureById"
        handle-as="json"
        body=""
        method="POST"
        on-response="secondCallBack"
        debounce-duration="300">
      </shape-iron-ajax-helper>
      <paper-dialog-scrollable>
      <template is="dom-repeat" items="{{measures}}" measure={{item}}>
            <paper-material class="pms">
                <div class="parent">
                    <div class="child header" value="{{nqfid}}">NQF ID: <span>{{item.nqfId}}</span></div>
                    <div class="child header">{{item.name}}</div>
                    <div class="child">
                        <paper-icon-button icon="info" on-tap="measureDetail" id="{{item.name}}" data="{{item.description}}"></paper-icon-button>
                    </div>
                </div>
                <div class="child description">{{item.description}}</div>
                <div class="parent">
                    <div class="fraction1 child">
                        <span class="fup">Numerator</span>
                        <span class="bar">/</span>
                        <span class="fdn">Denominator</span>
                    </div>
                    <div class="child header">=</div>
                    <div class="fraction2 child">
                        <span class="fup">{{item.numeratorValue}}</span>
                        <span class="bar">/</span>
                        <span class="fdn">{{item.denominatorValue}}</span>
                    </div>
                    <div class="child">
                      <google-chart
                        id="measureChart"
                        type="pie"
                        data="{{item.chartData}}"
                        options="{{item.chartOptions}}">
                      </google-chart>
                    </div>
                    <div class="child">
                        <paper-button raised on-tap="editMeasure" measure={{item}} id="{{item.name}}">Edit</paper-button>
                    </div>
                </div>
                <div class="parent">
                    <paper-material elevation="0" class="child resultBox">
                        <div class="resultForward">Your Measure Results:</div>
                        <div class="results">{{computePercentage(item.numeratorValue, item.denominatorValue)}}
                    </paper-material>
                </div>
                    <!-- this is where aggregate measure results used to be -->
                </paper-material>
        </template>
      </paper-dialog-scrollable>

    </template>
</dom-module> -->
<script>
    (function () {
        Polymer({
            is: 'app-history-list-view',
            properties: {
                currentMeasure: String,
                nMeasure: String,
                measureid: {
                  type: String
                },
                measure: {
                  type: String
                },
                measurenqfid: {
                  type: String
                },

            },
            ready: function() {
            },
            attached: function() {

            },

            addMeasure: function (e) {
                // var nMeasure = e.currentTarget.id;
                // console.log(nMeasure);
                // appDemographicAdd.nameOfMeasure=nMeasure;
                document.querySelector('app-demographic-add').setGetUserDataAjax();
                testVar.open();
            },
            computePercentage: function (numerator, denominator) {
                var ratio = 100 * numerator / denominator;
                var percent = Math.round(ratio * 10)/10
                return percent + '%';
            },
            measureDetail: function (e) {
                var nInfo = e.currentTarget.id;
                //console.log(nInfo);
                var nDescription = e.currentTarget.data;
                console.log(nDescription);
                measureEdit=e.currentTarget;
                appInformationModal.nameOfMeasure=nInfo;
                appInformationModal.detailedDescription=nDescription;
                infoMod.open();
            },
            //To be added to object to style graphs:
            //"slices": ["0": {'color': #32cd32}, "1": {'color': 'transparent'}],

            callBack: function(request) {
              console.log(request.detail.response);
              //this.measures.nqfId=
              // selectMeasure=document.getElementById('selectMeasure').value;
              console.log(this.measures);

              // for(var i = 0; i<this.measures.length; i++){
              //   if (this.measures[i].nqfId == selectedMeasure){
              //       this.set(selectedMeasure = ;
              //   };
              // };

              //targetMeasure
              //this.modalreportPeriodYear=request.detail.response.
              var response = request.detail.response;

              // get additional measure data
              this.$.findMeasureByOrg.body = JSON.stringify(response);
              this.$.findMeasureByOrg.generateRequest();

              // display measure data we currently have
              this.set('measures', response);
              for (var measure in response) {
                var currentMeasure = response[measure];
                var chartData = [
                  ['Month', 'Days'],
                  ['Well Controlled', currentMeasure.numeratorValue],
                  ['Poorly Controlled', currentMeasure.denominatorValue]
                ];
                var chartOptions = {
                  "pieHole": ".6",
                  "pieSliceText": "none"
                };
                this.set('measures.'+measure+'.chartData', chartData);
                this.set('measures.'+measure+'.chartOptions', chartOptions);
              }

            },

            secondCallBack: function(request) {
              var response = request.detail.response;
              console.log(response);
              // // for each measure
                var currentMeasure = document.getElementById('selectMeasure').value;

                // find appropriate object of additional data
                var done = false;
                for (var object = 0; object < response.length && !done; object++) {
                  var currentObject = response[object];
                  if (currentObject.nqfId == currentMeasure) {
                    done = true;

                    //and add that data to it
                    for (var property in currentObject) {
                      var polymerResource = 'measures.' + measure + '.' + property;
                      this.set(polymerResource, currentObject[property]);
                    }
                  }
                }
            },

            modalMeasuresFunction : function () {
              modalMeasures=this.measures;
              selectedMeasure=document.getElementById('selectMeasure').value;
              console.log(selectedMeasure);
            },

            setAjaxMeasure: function() {
              this.$.findMeasureInput.resource = '/common/organization_measure/findAllByOrg/' + document.getElementById('findUserOrganizations').value;
              this.$.findMeasureInput.callBack = this.callBack;
              this.$.findMeasureInput.generateRequest();
            },
        });
    })();
</script> -->
