<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../elements.html">

<dom-module id="app-login">
    <style>

        paper-material {
          max-width: 400px;

        }
        h1 {
          left: 15px;
          font-size: 15px;
          padding-left: 10px;
          padding-top: 10px;
        }
        paper-input {
          margin: auto;
          width: 50%;
          padding: 10px;
        }
        #login {
          margin-left: auto;
          margin-right: 10px;
          padding-left: 50px;
        }
        #forgotPasswordButton {
          margin-left: 10px;
          margin-right: auto;

        }
        paper-material {
          margin-left: auto;
          margin-right: auto;

        }
        paper-button {
          padding: 20px;
          margin-left: auto;
          margin-right: auto;
          display: inline-block;
        }
        /*.buttons {
          margin-left: auto;
          margin-right: auto;
        }*/

    </style>
    <template>
      <paper-material elevation="2">
        <h1>SHAPE Login</h1>
          <paper-input id="userIdInput" label="User ID"></paper-input>
            <br/>
          <paper-input label="Password" id="passwordInput" type="password"></paper-input>
            <paper-button id="login" on-tap="logIn" raised noink>Login</paper-button>
            <paper-button id="forgotPasswordButton" on-tap="setSecureCall" raised noink>Forgot Password?</paper-button>
      </paper-material-->
          <!--iron-ajax
                  id="loginCall"
                  url="http://localhost:8080/jump-service/jump/auth/login/"
                  on-response="loginResponse"
                  method="POST"
                  handle-as="json"
                  content-type="application/json"
          >
          </iron-ajax>
          <iron-ajax
                  id="secureCall"
                  url="http://localhost:8080/jump-service/jump/user/get/mobile_exercise_scr/u2/11-10-2015"
                  on-response="secureCallResponse"
                  method="GET"
                  handle-as="json"
          >
          </iron-ajax-->
          <shape-iron-ajax-helper id="loginCall">
          </shape-iron-ajax-helper>
          <shape-iron-ajax-helper id="secureCall">
          </shape-iron-ajax-helper>
          <shape-iron-ajax-helper
              id="findUsers"
              resource=""
              handle-as="json"
              on-response="callBackfindUsers"
              debounce-duration="300">
          </shape-iron-ajax-helper>
    </template>

    <!--shape-iron-ajax-helper
      id='logInCall'
      resource='/auth/login/'
      callback='callBack'
    ></shape-iron-ajax-helper-->
</dom-module>
<script>
    (function () {
        Polymer({
            is: 'app-login',

            properties: {
                route: {
                  type: String
                },

                userId: {
                    type: String,
                    notify: true
                },
                password: {
                    type: String
                }
            },
            loginResponse: function(response){
              app.$.loginPage.$.passwordInput.value="";
              app.$.loginPage.$.findUsers.resource="/admin/user/find/" + app.$.loginPage.$.userIdInput.value;
              app.$.loginPage.$.findUsers.callBack=this.callBackfindUsers;
              app.$.loginPage.$.findUsers.generateRequest();
              //localStorage.token= event.detail.response.token;
              app.$.loginPage.setSecureCall();

            },

            logIn: function () {
              this.$.loginCall.callBack = this.loginResponse;
              this.$.loginCall.login(this.$.userIdInput.value, this.$.passwordInput.value);
            },
            logout: function(){
              localStorage.token = "";
              app.select = "login"
            },

            callBackfindUsers: function(request) {
              console.log(request.detail.response);
              callBackUser=request.detail.response;
              if  (callBackUser.resetPwd == true) {
                    app.select = "setupAccount";
              }   else {
                app.select = "main";
                //this.$.loginCall.login(this.$.userIdInput.value, this.$.passwordInput.value);
                document.querySelector('app-account-setup').ajaxFindUsers();
                document.querySelector('app-dashboard').setAjax();
                document.querySelector('app-history').setajaxMeasures();
              };
            },

            setSecureCall: function(){
                // var call = this.$.secureCall;
                //call.resource = "/user/get/mobile_exercise_scr/u2/11-16-2015";
                // call.method = "GET"
                // call.callBack = this.secureCallResponse;
                // call.generateRequest();
            },
            secureCallResponse: function(response){
                console.log(event.detail.response)
            },
            navigateHome: function (e) {
                this.selected = 'main';
            }
        });
    })();
</script>
