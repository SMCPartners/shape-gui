<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../elements.html">

<dom-module id="app-dashboard">
    <style>
        .pms {
        @apply(--pm-style)
        }

        select[selected] {
            border: none;
        }
        select {
            height: 2.5em;
            font-size: 1em;
            background: transparent;
            border: none;
        }
        select[focused] {
            border: none;
        }

        .flex-child {
            order: 0;
            flex: 0 1 auto;
            align-self: center;
        };
        .flex-parent {
            display: flex;
            flex-direction: row;
            flex-wrap: wrap;
            justify-content: space-around;
            align-content: space-between;
            align-items: flex-start;
        };

        paper-tab[tabindex="0"] {
            background-color: rgba(63, 81, 181, 0.9);
            color: white;
            font-weight: bold;
        };

        paper-tabs {
            box-shadow: 0px 2px 2px 0px lightgray;
            --paper-tabs-selection-bar-color: rgba(63, 81, 181);
        }
    </style>
    <template>
        <div style="margin: 0.5em 0;" class="flex-parent">
            <div class="flex-parent flex-child">
                <label class="flex-child" style="font: inherit; margin-left:0.5em;"> <b>Organization: </b></label>
                <div class="flex-child" style="box-shadow: 1px 1px 1px 1px lightgray; margin: 0 1em;">
                    <select id=findUserOrganizations style="font: inherit; margin-left:0.5em;" on-change="loadOrgData">
                      <option>Select Organization</option>
                        <template is="dom-repeat" restamp="true" userOrganization={{item}} items="{{organizations}}">
                            <option style="font: inherit" value="{{item.id}}">{{item.name}}</option>
                        </template>
                    </select>
                </div>
            </div>

            <div class="flex-parent flex-child">
                <label class="flex-child" style="font: inherit; margin-left:0.5em;"><b>Provider:</b></label>
                <div class='flex-child' style="box-shadow: 1px 1px 1px 1px lightgray; margin: 0 1em;">
                    <select name="organization" style="font: inherit;">
                        <template is="dom-repeat" items="{{providers}}">
                            <option style="font: inherit" value="{{item.id}}">{{item.name}}</option>
                          </template>
                      </select>
                  </div>
              </div>
            <!--<div class="flex-parent flex-child">
                <label class="flex-child" style="font: inherit; margin-left:0.5em;"> <b>Quarter: </b></label>
                <div class="flex-child" style="box-shadow: 1px 1px 1px 1px lightgray; margin: 0 1em;">
                    <select name="quarter" style="font: inherit">
                        <template is="dom-repeat" items="{{quarters}}">
                            <option style="font: inherit" value="{{item.quarter}}">{{item.quarter}}</option>
                        </template>
                    </select>
                </div>
            </div>
            <div class="flex-parent flex-child">
                <label class="flex-child" style="font: inherit; margin-left:0.5em;"> <b>Year: </b></label>
                <div class="flex-child" style="box-shadow: 1px 1px 1px 1px lightgray; margin: 0 1em;">
                    <select name="year" style="font: inherit">
                        <template is="dom-repeat" items="{{years}}">
                            <option style="font: inherit" value="{{item.year}}">{{item.year}}</option>
                        </template>
                    </select>
                </div>
              </div-->
            <!--  box-shadow: 1px 1px 1px 1px lightgray -->
        </div>
            <paper-tabs selected="{{selected}}" noink no-slide>

            <paper-tab>Measure Input</paper-tab>
            <paper-tab>Past Measure Reports</paper-tab>
            <paper-tab>Organization Profile</paper-tab>
        </paper-tabs>
        <iron-pages selected="{{selected}}">
            <app-measure-input id=appMeasureInput
              inputMeasureID={{inputMeasureID}}
              reportPeriodQuarter={{reportPeriodQuarter}}
              reportPeriodYear={{reportPeriodYear}}
              dbid={{dbid}}
              ></app-measure-input>
            <app-history id="history"></app-history>
            <app-profile></app-profile>
        </iron-pages>

        <shape-iron-ajax-helper
          id="findOrgs"
          resource="/admin/organization/findAll"
          method="GET"
          handle-as="json"
          on-response="callBackOrgs"
          debounce-duration="300">
        </shape-iron-ajax-helper>

        <shape-iron-ajax-helper
          id="findProviders"
          resource="/common/provider/findAll"
          method="GET"
          handle-as="json"
          on-response="callBackProviders"
          debounce-duration="300">
        </shape-iron-ajax-helper>

    </template>
</dom-module>
<script>
    (function () {
        Polymer({
            is: 'app-dashboard',
            properties: {
              selectedOrganization: 1
            },
            // orgStrat: function() {
            //   console.log("go");
            //   document.querySelector('app-profile').organizationID = this.selectedOrganization;
            //   document.querySelector('app-profile').setajax();
            // },

            setAjax: function () {
              this.$.findOrgs.generateRequest();
              this.$.findProviders.generateRequest();
            },

            callBackOrgs: function(request) {
              this.organizations = request.detail.response;
            },

            callBackProviders: function(request) {
              this.providers = request.detail.response;
            },

            ready: function() {
                this.selected = 0;
                // this.organizations = [
                //     {_id: "1", name: "Organization 1"},
                //     {_id: "2", name: "Organization 2"}
                // ];
                this.providers = [
                    {_id: "1", name: "Provider 1"},
                    {_id: "2", name: "Provider 2"},
                    {_id: "2", name: "Provider 3"}
                ];
                this.quarters = [
                  {quarter: '1'},
                  {quarter: '2'},
                  {quarter: '3'},
                  {quarter: '4'}
                ];
                this.years = [
                  {year: '2015'},
                  {year: '2016'},
                  {year: '2017'},
                  {year: '2018'}
                ];
            },

            loadOrgData: function() {
              document.querySelector('app-measure-input').setAjaxMeasure();
              document.querySelector('app-profile').organizationID = this.selectedOrganization;
              document.querySelector('app-profile').setajax();

            }
        });
    })();
</script>
