<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../elements.html">


<dom-module id="app-history-demographics">
    <style>
    google-chart {
      width: 80%;
      padding-top: 5px;
      margin-top: 0px;
      margin-left: auto;
      margin-right: auto;
    }
    h3 {
      padding-left: 5%;
    }
    h2 {
      padding-left: 5%;
    }
    .measureDescription {
      text-align: justify;
      width: 60%;
      margin-left: auto;
      margin-right: auto;
      padding-top: 10px;
      padding-bottom: 10px;

    }
    .incompleteGraph {
      font-weight:400;
    }

    </style>
    <template>
      <shape-iron-ajax-helper
        id="showAppHistoryDemographics"
        handle-as="json"
        method="GET"
        on-response="appHistDemograhicCallBack"
        debounce-duration="300">
      </shape-iron-ajax-helper>
      <template is='dom-repeat' items='{{orgMeasCharts}}' filter="{{_filter(filterVal)}}">


        <paper-material>
          <h2>NQF ID: <span>{{item.nqfId}}</span>&nbsp;<span>{{item.name}}</span>:</h2>
          <h2>Year:&nbsp;<span>{{item.reportPeriodYear}}</span></h2>
                    <div class="measureDescription">
                      <p>{{item.description}}</p>
                    </div>


                      <h3>NQF measure&nbsp;<span>{{item.nqfId}}</span>&nbsp;by Race:</h3>
                      <template is="dom-if" if="{{item.raceData}}" restamp="true">
                        <google-chart
                          options='{"vAxis": {"format":"percent", "viewWindow": {"min": 0, "max": 1} } }'
                          cols='[{"label": "Data", "type": "string"},{"label": "Num / Den", "type": "number"},{"role": "tooltip", "type": "string"}]'
                          rows='{{item.raceData}}'>
                        </google-chart>
                      </template>
                      <template is="dom-if" if="{{isChartIncomplete(item.raceData)}}" restamp="true">
                        <p class= "incompleteGraph" >Data not available for chart.</p>
                      </template>


                      <h3>NQF measure&nbsp;<span>{{item.nqfId}}</span>&nbsp;by Age:</h3>
                      <template is="dom-if" if="{{item.ageData}}" restamp="true">
                        <google-chart
                          options='{"vAxis": {"format":"percent", "viewWindow": {"min": 0, "max": 1} } }'
                          cols='[{"label": "Data", "type": "string"},{"label": "Num / Den", "type": "number"},{"role": "tooltip", "type": "string"}]'
                          rows='{{item.ageData}}'>
                        </google-chart>
                      </template>
                      <template is="dom-if" if="{{isChartIncomplete(item.ageData)}} restamp="true"">
                        <p class= "incompleteGraph" >Data not available for chart.</p>
                      </template>


                      <h3>NQF measure&nbsp;<span>{{item.nqfId}}</span>&nbsp;by Ethnicity:</h3>
                      <template is="dom-if" if="{{item.ethnicityData}}" restamp="true">
                        <google-chart
                          options='{"vAxis": {"format":"percent", "viewWindow": {"min": 0, "max": 1} } }'
                          cols='[{"label": "Data", "type": "string"},{"label": "Num / Den", "type": "number"},{"role": "tooltip", "type": "string"}]'
                          rows='{{item.ethnicityData}}'>
                        </google-chart>
                      </template>
                      <template is="dom-if" if="{{isChartIncomplete(item.ethnicityData)}}" restamp="true">
                        <p class= "incompleteGraph" >Data not available for chart.</p>
                      </template>


                      <h3>NQF measure&nbsp;<span>{{item.nqfId}}</span>&nbsp;by Gender:</h3>
                      <template is="dom-if" if="{{item.genderData}}" restamp="true">
                        <google-chart
                          options='{"vAxis": {"format":"percent", "viewWindow": {"min": 0, "max": 1} } }'
                          cols='[{"label": "Data", "type": "string"},{"label": "Num / Den", "type": "number"},{"role": "tooltip", "type": "string"}]'
                          rows='{{item.genderData}}'>
                        </google-chart>
                      </template>
                      <template is="dom-if" if="{{isChartIncomplete(item.genderData)}}" restamp="true">
                        <p class= "incompleteGraph" >Data not available for chart.</p>
                      </template>
                     </paper-material>


                    </template>

                    <!-- <h2>Age</h2>
                    <google-chart
                      type='column'
                      data='{{item.ageData}}'>
                    </google-chart>
                    <h2>Ethnicity</h2>
                    <google-chart
                      type='column'
                      data='{{item.ethniData}}'>
                    </google-chart>
                    <h2>Gender</h2>
                    <google-chart
                      type='column'
                      data='{{item.genderData}}'>
                    </google-chart> -->
        </paper-material>

                    <!-- <google-chart
                        type='column'
                        options='{"title": "Inventory"}'
                        data='[
                              [ ["Year", "Things", "Stuff"],
                               ["2004", 1000, 400],
                               ["2005", 1170, 460],
                               ["2006", 660, 1120],
                               ["2007", 1030, 540] ]'>
                    </google-chart> -->
     </template>

    </template>
</dom-module>
<script>
    (function () {
        Polymer({
            is: 'app-history-demographics',
            properties: {
              filterVal: "defaultFilter"
            },
            ready: function() {
            },
            appHistDemograhicCallBack: function(evt){

              var historyDemographics = evt.detail.response;
              var demographicCharts = [
                'ageData',
                'ethnicityData',
                'genderData',
                'raceData'
              ];
              for (var demographic in historyDemographics) {
                var currentDemographic = historyDemographics[demographic];
                for (var chart in demographicCharts) {
                  var currentChart = currentDemographic[ demographicCharts[chart] ];
                  for (var value in currentChart) {
                    var currentValue = currentChart[value];
                    var tooltip = Math.round(currentValue[1] * 100) + '%';
                    currentValue.push(tooltip);
                  }
                }
              }
              this.set("orgMeasCharts", historyDemographics);

            },
            setAjax: function(orgId, measureId, year){
              this.$.showAppHistoryDemographics.resource="/common/show/appHistDemographic/"+orgId+"/"+measureId+"/"+year;
              this.$.showAppHistoryDemographics.generateRequest();
            },
            isChartIncomplete: function(array){
              if (array[0]=="false"){
                return true;
              }else{
                return false;
              }

            }
            // _filter: function(val) {
            //     return function(orgMeasCharts) {
            //         // if (!val) return true;
            //         // if (!orgMeasCharts) return false;
            //         // return(orgMeasCharts.reportYear && ~orgMeasCharts.reportYear.indexOf(val));
            //         console.log(orgMeasCharts.reportYear === app.$.mainPage.$.dashboard.$.history.$.yearSelect.value && orgMeasCharts.measureNQF === app.$.mainPage.$.dashboard.$.history.$.measureSelect.value);
            //         return (orgMeasCharts.reportYear === app.$.mainPage.$.dashboard.$.history.$.yearSelect.value && orgMeasCharts.measureNQF === app.$.mainPage.$.dashboard.$.history.$.measureSelect.value)
            //         // return true;
            //    };
            //  }
        });
    })();


</script>
