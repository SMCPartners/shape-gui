<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../elements.html">

<dom-module id="app-admin-panel-measure">
    <style>
        .pms {
        @apply(--pm-style)
        };

        th {
        text-align: center;
        background-color: #0066FF;
        color: white;
        border-right: 1px solid #808080;
        border-bottom: 1px solid #808080;
        font-weight: bold;
        };

        th, td {padding: 10px 15px;
        };

        thead {
        background: #395870;
        color: #fff;
        };

        td {
        border-bottom: 1px solid #cecfd5;
        border-right: 1px solid #cecfd5;
        };

        td: first-child {
        border-left: 1px solid #cecfd5;
        };

        tr: nth-child(even) {
        background-color: #395870;

        .addButton {
        display: flex;
        flex-direction: row;
        flex-wrap: nowrap;
        justify-content: flex-end;
        align-content: stretch;
        align-items: center;
        };

        table {
        border-collapse: separate;
        border-spacing: 0;
        };

    </style>
    <template>
        <div class="row-inline">
            <input class="pull-left" type="text" value="{{filterVal::input}}" data-table="order-table" placeholder="Search">
            <paper-button style="float: right" raised on-tap="addMeasure" modalName="addMeasure">Add Measure</paper-button>
        </div>
        <label>Sort By:</label>
        <select value="{{sortVal::change}}">
            <option>Select:</option>
            <option value="nqfID">NQF ID</option>
            <option value="cmsID">CMS ID</option>
            <option value="measureName">Name</option>
            <option value="measureDescription">Description</option>
        </select>
        <table class="order-table table-rows" style="width: 100%">
            <colgroup>
                <col span="3" style="width:15%">
                <col span="1" style="width:35%">
                <col span="1" style="width:10%">
            </colgroup>
            <thead>
                <th>NQF ID</th>
                <th>CMS ID</th>
                <th>Name</th>
                <th>Description</th>
            </thead>
            <tbody>
            <template is="dom-repeat" items="{{measure}}" filter="{{_filter(filterVal)}}" sort="{{_sort(sortVal)}}">
            <tr>
                <td><span>{{item.nqfID}}</span></td>
                <td><span>{{item.cmsID}}</span></td>
                <td><span>{{item.measureName}}</span></td>
                <td><span>{{item.measureDescription}}</span></td>
                <td style="font-size: 12px">
                    <div class="editButton">
                        <paper-button raised on-tap="editMeasure" modalName="editMeasure">Edit</paper-button>
                    </div>
                </td>
            </tr>
            </template>
                <app-admin-add id="inputModal"></app-admin-add>
                <app-admin-edit id="editModal"></app-admin-edit>
            </tbody>
        </table>
    </template>
</dom-module>
<script>
    (function() {
    Polymer({
            is: 'app-admin-panel-measure',
            properties: {},

            ready: function() {
            this.measure=[
            {nqfID: '0018', cmsID: '165v3', measureName: 'Controlling Blood Pressure'},
            {nqfID: '0059', cmsID: '123v2', measureName: 'Diabetes: HbA1c Poor Control', measureDescription: 'Percentage of patients 18-85 years of age who had a diagnosis of hypertension and whose blood pressure was adequately controlled (<140/90 mmHg) during the measurement period'},
            ];
            },

            _filter: function(val) {
                return function(measure) {
                    if (!val) return true;
                    if (!measure) return false;
                    return (measure.nqfID && ~measure.nqfID.toLowerCase().indexOf(val.toLowerCase())) ||
                            (measure.cmsID && ~measure.cmsID.toLowerCase().indexOf(val.toLowerCase())) ||
                            (measure.measureName && ~measure.measureName.toLowerCase().indexOf(val.toLowerCase())) ||
                            (measure.measureDescription && ~measure.measureDescription.toLowerCase().indexOf(val.toLowerCase()));
               };
            },

            _sort: function(val) {
                switch(val) {
                case 'nqfID':
                    return function(a, b) {
                    if (a.nqfID.toLowerCase() === b.nqfID.toLowerCase()) return 0;
                    return a.nqfID.toLowerCase() < b.nqfID.toLowerCase() ? -1 : 1;
                    };

                 case 'cmsID':
                    return function(a, b) {
                    if (a.cmsID.toLowerCase() === b.cmsID.toLowerCase()) return 0;
                    return a.cmsID.toLowerCase() < b.cmsID.toLowerCase() ? -1 : 1;
                    };

                  case 'measureName':
                    return function(a, b) {
                    if (a.measureName.toLowerCase() === b.measureName.toLowerCase()) return 0;
                    return a.measureName.toLowerCase() < b.measureName.toLowerCase() ? -1 : 1;
                    };

                  case 'measureDescription':
                    return function(a, b) {
                    if (a.measureDescription.toLowerCase() === b.measureDescription.toLowerCase()) return 0;
                    return a.measureDescription.toLowerCase() < b.measureDescription.toLowerCase() ? -1 : 1;
                    };
                }
             },

            editMeasure: function(e) {
                this.$.editModal.editButton(e.target.parentNode.getAttribute("modalName"));
            },

            addMeasure: function(e) {
                this.$.inputModal.addButton(e.target.parentNode.getAttribute("modalName"));
            }
        });
})();
</script>