<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../elements.html">

<dom-module id="app-demographic-input">
<style>

    .size-position {
      width: 95%;
      height: 95%;
    }

    select[selected] {
    border: none;
    }
    select {
    height: 2.5em;
    font-size: 1em;
    background: transparent;
    border: none;
    }
    select[focused] {
    border: none;
    }
    paper-input-container {
      /*margin: 20px;*/
      margin-left: 20px;
      margin-right: 20px;
      margin-bottom: 25px;
      width: 200px;
      display: inline-block;
    }

    .dropdown_box {
      display: inline-block;
    }
    /*.input-element {
      display: block;
    }*/
    .input {
      display: inline-block;
    }
    h3 {
      font-size: 1.5em;
      padding-top: 20px;
      padding-left:20px;
      padding-right: 20px;

    }
    h4 {
      padding-top: 20px;
      padding-left: 50px;
      margin: 0;
      font-size: 1em;
    }
    .headerTitle {
      padding: 0px;
      margin: 5px;
    }
    paper-dialog-scrollable {
      border-top: 1px solid black;
      border-bottom: 1px solid black;
      margin: 0px;
      max-width: 850px;
    }
    paper-dialog {
      max-width: 850px;
    }
    .input-box {
      margin-left: auto;
      margin-right: auto;
      width: 65%;
    }

    .inputField {
      width: 200px;
      padding: 0 20px 25px 20px;
    }

</style>
<template>
  <paper-dialog id="demIn" modal class="size-position" style="background: white">
      <h1>{{measureName}}</h1>
        <paper-dialog-scrollable  elevation="3">
            <!--paper-material elevation="5"-->
              <div class="input-element">
                <paper-material elevation="5">
                  <h3>Total</h3>
                  <div class="input-box">
                    <paper-input label="Numerator" class="inputField" value="{{demographic.numeratorValue}}" id="mainNum" prevent-invalid-input allowed-pattern="[0-9]"></paper-input>
                  </div>
                  <div class="input-box">
                    <paper-input label="Denominator" class="inputField" value="{{demographic.denominatorValue}}" id="mainDen" prevent-invalid-input allowed-pattern="[0-9]"></paper-input>
                  </div>
                </paper-material>
              </div>
            <!--/paper-material-->
              <div class="input-element">
                <template is="dom-repeat" items="{{stratifyGroups}}" as="group">
                  <paper-material elevation="3">
                    <h3>{{group.name}}</h3>
                      <template is="dom-repeat" items="{{group.categories}}" as="category">
                          <h4>{{category.strat}}</h4>
                            <div class="input-box">
                              <paper-input label="Numerator" class="inputField" value="{{ getDemographicProperty(demographic, category.num) }}" id="category.num" prevent-invalid-input allowed-pattern="[0-9]"></paper-input>
                            </div>
                            <div class="input-box">
                              <paper-input label="Denominator" class="inputField" value="{{ getDemographicProperty(demographic, category.den) }}" id="category.den" prevent-invalid-input allowed-pattern="[0-9]"></paper-input>
                            </div>
                          </div>
                      </template>
                    </paper-material>
                  </template>
              </div>
        </paper-dialog-scrollable>

        <div class="buttons">
            <paper-button raised class="child" on-tap="addMeasureDemographics" elevation="3">Submit</paper-button>
            <paper-button raised class="child" on-tap="cancelLog" elevation="3">Cancel</paper-button>
        </div>
    </paper-dialog>
    <shape-iron-ajax-helper
      id="ajaxAddMeasureDemographics"
      resource=""
      body=""
      method="POST"
      handle-as="json"
      on-response="callBackMeasureDemographics"
      debounce-duration="300">
    <shape-iron-ajax-helper>
    <shape-iron-ajax-helper
      id="findUser"
      resource=""
      handle-as="json"
      on-response="callBackUser"
      debounce-duration="300">
    </shape-iron-ajax-helper>
</template>
</dom-module>
<script>
  (function () {
      Polymer({
          is: 'app-demographic-input',
          properties: {
              nameOfMeasure: {
                  type: String
                },
              maleNum : {
                type: String
                },
              maleDen : {
                type: String
              },
              measureID :{
                type: String
              }
              },
                ready: function () {
              },

        loadMeasureStratification: function (e) {

          this.quarterChoose = [
            {_id: "1", quarter: "1st Quarter"},
            {_id: "2", quarter: "2nd Quarter"},
            {_id: "3", quarter: "3rd Quarter"},
            {_id: "4", quarter: "4th Quarter"}
          ]
          this.yearChoose = [
            {_id: "1", year: 2000},
            {_id: "2", year: 2001},
            {_id: "3", year: 2002},
            {_id: "4", year: 2003},
            {_id: "5", year: 2004},
            {_id: "6", year: 2005},
            {_id: "7", year: 2006},
            {_id: "8", year: 2007},
          ];

          this.measures = [
                {_id: "1", name: "Controlling High Blood Pressure", nqf: "0018"},
                {_id: "2", name: "Diabetes: HbA1c Poor Control", nqf: "0059"}
          ];

          this.stratifyGroups = [
              {name: 'Gender', categories: [
                {strat: 'Male', num: 'genderMaleNum', den: 'genderMaleDen'},
                {strat: 'Female', num: 'genderFemaleNum', den: 'genderFemaleDen'} ]
          },

              {name: 'Age', categories: [
                {strat: 'Under 18', num: 'ageUnder17Num', den: 'ageUnder17Den'},
                {strat: '18-44 Years', num: 'age1844Num', den: 'age1844Den'},
                {strat: '45-64 Years', num: 'age4564Num', den: 'age4564Den'},
                {strat: '65-85 Years', num: 'ageOver65Num', den: 'ageOver65Den'} ]
          },
              {name: 'Ethnicity', categories:[
                {strat: 'Hispanic/Latino', num: 'ethnicityHispanicLatinoNum', den: 'ethnicityHispanicLatinoDen'},
                {strat: 'Not Hispanic/Latino', num: 'ethnicityNotHispanicLatinoNum', den: 'ethnicityNotHispanicLatinoDen'} ]
          },
              {name: 'Race', categories: [
                {strat: 'African American/Black', num: 'raceAfricanAmericanNum', den: 'raceAfricanAmericanDen'},
                {strat: 'American Indian or Alaska Native', num: 'raceAmericanIndianNum', den: 'raceAmericanIndianDen'},
                {strat: 'Asian', num: 'raceAsianNum', den: 'raceAsianDen'},
                {strat: 'Native Hawaiian or Pacific Islander', num: 'raceNativeHawaiianNum', den: 'raceNativeHawaiianDen'},
                {strat: 'White', num: 'raceWhiteNum', den: 'raceWhiteDen'},
                {strat: 'Other', num: 'raceOtherNum', den: 'raceOtherDen'} ]
              }
          ];
        },

        addMeasureDemographics: function () {
            userLoginId=document.getElementById('userIdInput').value;
            measureId=appMeasureInput.inputMeasureID;
            dbid=appMeasureInput.dbid;
            console.log(appMeasureInput.reportPeriodQuarter);
            rpquarter=appMeasureInput.reportPeriodQuarter;
            rpyear=appMeasureInput.reportPeriodYear;
            this.$.ajaxAddMeasureDemographics.resource="/common/organization_measure/edit";

            var orgMeasureProperties = ['id', 'numeratorValue',
              'denominatorValue', 'rpDate', 'genderMaleNum',
              'genderMaleDen', 'genderFemaleNum', 'genderFemaleDen',
              'genderOtherNum', 'genderOtherDen', 'ageUnder17Num',
              'ageUnder17Den', 'age1844Num', 'age1844Den', 'age4564Num',
              'age4564Den', 'ageOver65Num', 'ageOver65Den',
              'ethnicityHispanicLatinoNum', 'ethnicityHispanicLatinoDen',
              'ethnicityNotHispanicLatinoDen', 'raceAfricanAmericanNum',
              'raceAfricanAmericanDen', 'raceAmericanIndianNum',
              'raceAmericanIndianDen', 'raceAsianNum', 'raceAsianDen',
              'raceNativeHawaiianNum', 'raceNativeHawaiianDen',
              'raceWhiteNum', 'raceWhiteDen', 'raceOtherNum',
              'raceOtherDen', 'reportPeriodQuarter', 'reportPeriodYear',
              'organizationId', 'measureId', 'userId'];
            var newDemographicData = {};
            for (var property in orgMeasureProperties) {
              var currentProperty = orgMeasureProperties[property]
              newDemographicData[currentProperty] = this.demographic[currentProperty];
            }
            this.$.ajaxAddMeasureDemographics.body = JSON.stringify(newDemographicData);

            console.log(this.$.ajaxAddMeasureDemographics.body);
            console.log(rpquarter);
            console.log(rpyear);
            this.$.ajaxAddMeasureDemographics.method="POST";
            this.$.ajaxAddMeasureDemographics.callBack=this.callBackMeasureDemographics;
            this.$.ajaxAddMeasureDemographics.generateRequest();
            this.$.demIn.toggle();
          },

        callBackMeasureDemographics: function(request) {
          console.log(request);
          document.querySelector("app-measure-input").setAjaxMeasure();
        },

        ajaxFindUsers: function() {
          userLoginId=document.getElementById('userIdInput').value;
          this.$.findUser.resource = "/admin/user/find/" + userLoginId;
          console.log(this.$.findUser.resource);
          this.$.findUser.callBack = this.callBackUser;
          this.$.findUser.generateRequest();
        },

       callBackUser: function(request) {
         console.log(request.detail.response);
         console.log(request.detail.response.organizationId);
         userOrganizationId=request.detail.response.organizationId;
        //  this.measure = request.detail.response;
        //  console.log(this.measure);
      },

        // logNumbers: function (e) {
        //     var formSubmit = {
        //         mainNum: mainNum.value,
        //         mainDen: mainDen.value,
        //         maleNum: maleNum.value,
        //         maleDen: maleDen.value,
        //         femaleNum: femaleNum.value,
        //         femaleDen: femaleDen.value,
        //         blackNum: blackNum.value,
        //         blackDen: blackDen.value,
        //         indianNum: indianNum.value,
        //         indianDen: indianDen.value,
        //         asianNum: asianNum.value,
        //         asianDen: asianDen.value,
        //         hawaiianNum: hawaiianNum.value,
        //         hawaiianDen: hawaiianDen.value,
        //         whiteNum: whiteNum.value,
        //         whiteDen: whiteDen.value,
        //         otherNum: otherNum.value,
        //         otherDen: otherDen.value,
        //         hispanicNum: hispanicNum.value,
        //         hispanicDen: hispanicDen.value,
        //         notHispanicNum: notHispanicNum.value,
        //         notHispanicDen: notHispanicDen.value,
        //         eighteenNum: eighteenNum.value,
        //         eighteenDen: eighteenDen.value,
        //         fortyFiveNum: fortyFiveNum.value,
        //         fortyFiveDen: fortyFiveDen.value,
        //         sixtyFiveNum: sixtyFiveNum.value,
        //         sixtyFiveDen: sixtyFiveDen.value
        //     };
            //if we want to do field completion validation, we can start with below...phase 2?
            /*for (var i in formSubmit)
                {
                    if (formSubmit[i].length <= 0)
                        {
                            console.log(i)
                        };
                };
            console.log(formSubmit);*/
        // },
        cancelLog: function (e) {
            this.$.demIn.toggle();
        },
        getDemographicProperty: function(demographic, property) {
          return demographic[property];
        }
    });
})();
</script>
