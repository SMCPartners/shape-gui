<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../elements.html">

<dom-module id="app-demographic-input">
<style>

    .size-position {
      width: 95%;
      height: 95%;
    }

    select[selected] {
    border: none;
    }
    select {
    height: 2.5em;
    font-size: 1em;
    background: transparent;
    border: none;
    }
    select[focused] {
    border: none;
    }
    paper-input-container {
      /*margin: 20px;*/
      margin-left: 20px;
      margin-right: 20px;
      margin-bottom: 25px;
      width: 200px;
      display: inline-block;
    }

    .dropdown_box {
      display: inline-block;
    }
    /*.input-element {
      display: block;
    }*/
    .input {
      display: inline-block;
    }
    h3 {
      font-size: 1.5em;
      padding-top: 20px;
      padding-left:20px;
      padding-right: 20px;

    }
    h4 {
      padding-top: 20px;
      padding-left: 50px;
      margin: 0;
      font-size: 1em;
    }
    .headerTitle {
      padding: 0px;
      margin: 5px;
    }
    paper-dialog-scrollable {
      border-top: 1px solid black;
      border-bottom: 1px solid black;
      margin: 0px;
      max-width: 850px;
    }
    paper-dialog {
      max-width: 850px;
    }
    .input-box {
      margin-left: auto;
      margin-right: auto;
      width: 65%;
    }

</style>
<template>
  <paper-dialog id="demIn" modal class="size-position" style="background: white">
      <h1>{{measureName}}</h1>
        <paper-dialog-scrollable  elevation="3">
            <!--paper-material elevation="5"-->
              <div class="input-element">
                <paper-material elevation="5">
                  <h3>Total</h3>
                  <paper-input-container>
                        <label>Numerator</label>
                        <input class='inputField' id=mainNum is="iron-input" prevent-invalid-input allowed-pattern="[0-9]">
                  </paper-input-container>

                  <paper-input-container>
                        <label>Denominator</label>
                        <input class='inputField' id=mainDen is="iron-input" prevent-invalid-input=true allowed-pattern="[0-9]">
                  </paper-input-container>
                </paper-material>
              </div>
            <!--/paper-material-->
              <div class="input-element">
                <template is="dom-repeat" items="{{stratifyGroups}}" as="group">
                  <paper-material elevation="3">
                    <h3>{{group.name}}</h3>
                      <template is="dom-repeat" items="{{group.categories}}" as="category">
                          <h4>{{category.strat}}</h4>
                            <div class="input-box">
                              <paper-input-container>
                                <label>Numerator</label>
                                <input class='inputField' id="{{category.num}}" is="iron-input">
                            </paper-input-container>
                            <paper-input-container>
                                <label>Denominator</label>
                                <input class='inputField' id="{{category.den}}" is="iron-input">
                            </paper-input-container>
                          </div>
                      </template>
                    </paper-material>
                  </template>
              </div>
        </paper-dialog-scrollable>

        <div class="buttons">
            <paper-button raised class="child" on-tap="addMeasureDemographics" elevation="3">Submit</paper-button>
            <paper-button raised class="child" on-tap="cancelLog" elevation="3">Cancel</paper-button>
        </div>
    </paper-dialog>
    <shape-iron-ajax-helper
      id="ajaxAddMeasureDemographics"
      resource=""
      body=""
      method="POST"
      handle-as="json"
      on-response="callBackMeasureDemographics"
      debounce-duration="300">
    <shape-iron-ajax-helper>
    <shape-iron-ajax-helper
      id="findUser"
      resource=""
      handle-as="json"
      on-response="callBackUser"
      debounce-duration="300">
    </shape-iron-ajax-helper>
</template>
</dom-module>
<script>
  (function () {
      Polymer({
          is: 'app-demographic-input',
          properties: {
              nameOfMeasure: {
                  type: String
                },
              maleNum : {
                type: String
                },
              maleDen : {
                type: String
              },
              measureID :{
                type: String
              }
              },
                ready: function () {
              },

        loadMeasureStratification: function (e) {

          this.quarterChoose = [
            {_id: "1", quarter: "1st Quarter"},
            {_id: "2", quarter: "2nd Quarter"},
            {_id: "3", quarter: "3rd Quarter"},
            {_id: "4", quarter: "4th Quarter"}
          ]
          this.yearChoose = [
            {_id: "1", year: 2000},
            {_id: "2", year: 2001},
            {_id: "3", year: 2002},
            {_id: "4", year: 2003},
            {_id: "5", year: 2004},
            {_id: "6", year: 2005},
            {_id: "7", year: 2006},
            {_id: "8", year: 2007},
          ];

          this.measures = [
                {_id: "1", name: "Controlling High Blood Pressure", nqf: "0018"},
                {_id: "2", name: "Diabetes: HbA1c Poor Control", nqf: "0059"}
          ];

          this.stratifyGroups = [
              {name: 'Gender', categories: [
                {strat: 'Male', num: 'editMaleNum', den: 'editMaleDen'},
                {strat: 'Female', num: 'editFemaleNum', den: 'editFemaleDen'} ]
          },

              {name: 'Age', categories: [
                {strat: 'Under 18', num: 'editUnderEighteenNum', den: 'editUnderEighteenDen'},
                {strat: '18-44 Years', num: 'editEighteenNum', den: 'editEighteenDen'},
                {strat: '45-64 Years', num: 'editFortyFiveNum', den: 'editFortyFiveDen'},
                {strat: '65-85 Years', num: 'editSixtyFiveNum', den: 'editSixtyFiveDen'} ]
          },
              {name: 'Ethnicity', categories:[
                {strat: 'Hispanic/Latino', num: 'editHispanicNum', den: 'editHispanicDen'},
                {strat: 'Not Hispanic/Latino', num: 'editNotHispanicNum', den: 'editNotHispanicDen'} ]
          },
              {name: 'Race', categories: [
                {strat: 'African American/Black', num: 'editBlackNum', den: 'editBlackDen'},
                {strat: 'American Indian or Alaska Native', num: 'editIndianNum', den: 'editIndianDen'},
                {strat: 'Asian', num: 'editAsianNum', den: 'editAsianDen'},
                {strat: 'Native Hawaiian or Pacific Islander', num: 'editHawaiianNum', den: 'editHawaiianDen'},
                {strat: 'White', num: 'editWhiteNum', den: 'editWhiteDen'},
                {strat: 'Other', num: 'editOtherNum', den: 'editOtherDen'} ]
              }
          ];
        },

        addMeasureDemographics: function () {
            userLoginId=document.getElementById('userIdInput').value;
            measureId=appMeasureInput.inputMeasureID;
            dbid=appMeasureInput.dbid;
            console.log(appMeasureInput.reportPeriodQuarter);
            rpquarter=appMeasureInput.reportPeriodQuarter;
            rpyear=appMeasureInput.reportPeriodYear;
            this.$.ajaxAddMeasureDemographics.resource="/admin/organization_measure/edit";
            this.$.ajaxAddMeasureDemographics.body = JSON.stringify ({
                "numeratorValue": this.$.mainNum.value,
                "denominatorValue": this.$.mainDen.value,
                "genderMaleNum": editMaleNum.value,
                "rpDate": "2015-12-03",
                "genderMaleDen": editMaleDen.value,
                "genderFemaleNum": editFemaleNum.value,
                "genderFemaleDen": editFemaleDen.value,
                "raceAfricanAmericanNum": editBlackNum.value,
                "raceAfricanAmericanDen": editBlackDen.value,
                "raceAmericanIndianNum": editIndianNum.value,
                "raceAmericanIndianDen": editIndianDen.value,
                "raceAsianNum": editAsianNum.value,
                "raceAsianDen": editAsianDen.value,
                "raceNativeHawaiianNum": editHawaiianNum.value,
                "raceNativeHawaiianDen": editHawaiianDen.value,
                "raceWhiteNum": editWhiteNum.value,
                "raceWhiteDen": editWhiteDen.value,
                "genderOtherNum": editOtherNum.value,
                "genderOtherDen": editOtherDen.value,
                "ethnicityHispanicLatinoNum": editHispanicNum.value,
                "ethnicityHispanicLatinoDen": editHispanicDen.value,
                "ethnicityNotHispanicLatinoNum": editNotHispanicNum.value,
                "ethnicityNotHispanicLatinoDen": editNotHispanicDen.value,
                "ageUnder17Num": editUnderEighteenNum.value,
                "ageUnder17Den": editUnderEighteenNum.value,
                "age1844Num": editEighteenNum.value,
                "age1844Den": editEighteenDen.value,
                "age4564Num": editFortyFiveNum.value,
                "age4564Den": editFortyFiveDen.value,
                "ageOver65Num": editSixtyFiveNum.value,
                "ageOver65Den": editSixtyFiveDen.value,
                "raceOtherNum": editOtherNum.value,
                "raceOtherDen": editOtherDen.value,
                "id": dbid,
                "measureId": measureId,
                "organizationId": userOrganizationId,
                "userId": userLoginId,
                "reportPeriodQuarter" : rpquarter,
                "reportPeriodYear" : rpyear
          });
            console.log(this.$.ajaxAddMeasureDemographics.body);
            console.log(rpquarter);
            console.log(rpyear);
            this.$.ajaxAddMeasureDemographics.method="POST";
            this.$.ajaxAddMeasureDemographics.callBack=this.callBackMeasureDemographics;
            this.$.ajaxAddMeasureDemographics.generateRequest();
            this.$.demIn.toggle();
          },

        callBackMeasureDemographics: function(request) {
          console.log(request);
          document.querySelector("app-measure-input").setAjaxMeasure();
        },

        ajaxFindUsers: function() {
          userLoginId=document.getElementById('userIdInput').value;
          this.$.findUser.resource = "/admin/user/find/" + userLoginId;
          console.log(this.$.findUser.resource);
          this.$.findUser.callBack = this.callBackUser;
          this.$.findUser.generateRequest();
        },

       callBackUser: function(request) {
         console.log(request.detail.response);
         console.log(request.detail.response.organizationId);
         userOrganizationId=request.detail.response.organizationId;
        //  this.measure = request.detail.response;
        //  console.log(this.measure);
      },

        // logNumbers: function (e) {
        //     var formSubmit = {
        //         mainNum: mainNum.value,
        //         mainDen: mainDen.value,
        //         maleNum: maleNum.value,
        //         maleDen: maleDen.value,
        //         femaleNum: femaleNum.value,
        //         femaleDen: femaleDen.value,
        //         blackNum: blackNum.value,
        //         blackDen: blackDen.value,
        //         indianNum: indianNum.value,
        //         indianDen: indianDen.value,
        //         asianNum: asianNum.value,
        //         asianDen: asianDen.value,
        //         hawaiianNum: hawaiianNum.value,
        //         hawaiianDen: hawaiianDen.value,
        //         whiteNum: whiteNum.value,
        //         whiteDen: whiteDen.value,
        //         otherNum: otherNum.value,
        //         otherDen: otherDen.value,
        //         hispanicNum: hispanicNum.value,
        //         hispanicDen: hispanicDen.value,
        //         notHispanicNum: notHispanicNum.value,
        //         notHispanicDen: notHispanicDen.value,
        //         eighteenNum: eighteenNum.value,
        //         eighteenDen: eighteenDen.value,
        //         fortyFiveNum: fortyFiveNum.value,
        //         fortyFiveDen: fortyFiveDen.value,
        //         sixtyFiveNum: sixtyFiveNum.value,
        //         sixtyFiveDen: sixtyFiveDen.value
        //     };
            //if we want to do field completion validation, we can start with below...phase 2?
            /*for (var i in formSubmit)
                {
                    if (formSubmit[i].length <= 0)
                        {
                            console.log(i)
                        };
                };
            console.log(formSubmit);*/
        // },
        cancelLog: function (e) {
            this.$.demIn.toggle();
        }
    });
})();
</script>
