<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../elements.html">


<dom-module id="app-admin-add">
    <style>
        .pms {
        @apply(--pm-style)
        }

        select[selected] {
            border: none;
        }
        select {
            height: 2.5em;
            font-size: 1em;
            background: white;
            border: none;
        }
        select[focused] {
            border: none;
        }

    </style>
    <template>
        <paper-dialog id="addProvider" class="size-position modalBox">
            <div>
                <h2>Add New Provider</h2>
            </div>
            <paper-dialog-scrollable class="childtwo">
                <div>
                    <paper-input label="Name" value="{{providerData.name}}"></paper-input>
                </div>
                <div>
                    <paper-input label="NPI" value="{{providerData.npi}}"></paper-input>
                </div>
                <div>
                  <select id="providerOrgSelect">
                    <template is="dom-repeat" items="{{organizations}}">
                      <option>{{item.name}}</option>
                    </template>
                  </select>
                </div>
            </paper-dialog-scrollable>
            <div class="parenttwo">
                <paper-button raised class="child" on-tap="logProvider">Save</paper-button>
                <paper-button raised class="child" on-tap="closeProvider">Cancel</paper-button>
            </div>
        </paper-dialog>
        <paper-dialog id="addOrganization" class="size-position modalBox">
            <div>
                <h2>Add New Organization</h2>
            </div>
            <div class="childtwo">
                <div>
                    <paper-input label="Organization Name" value="{{name}}"></paper-input>
                </div>
                <div>
                    <paper-input label="Street Address" value="{{addressStreet}}"></paper-input>
                </div>
                <div>
                    <paper-input label="City" value="{{addressCity}}"></paper-input>
                </div>
                <div>
                    <paper-input label="State" value="{{addressState}}"></paper-input>
                </div>
                <div>
                    <paper-input label="Zip" value="{{addressZip}}"></paper-input>
                </div>
                <div>
                    <paper-input label="Primary Contact Name" value="{{primaryContactName}}"></paper-input>
                </div>
                <div>
                    <paper-input label="Primary Contact email" value="{{primaryContactEmail}}"></paper-input>
                </div>
                <div>
                    <paper-input label="Primary Contact Phone" value="{{primaryContactPhone}}"></paper-input>
                </div>
                <div>
                    <paper-input label="Primary Contact Role" value="{{primaryContactRole}}"></paper-input>
                </div>
            </div>
            <div class="parenttwo">
                <paper-button raised class="child" on-tap="logOrganization">Save</paper-button>
                <paper-button raised class="child" on-tap="closeOrganization">Cancel</paper-button>
            </div>
        </paper-dialog>
        <paper-dialog id="addUser" class="size-position modalBox">
            <div>
                <h2>Add New User</h2>
            </div>
            <paper-dialog-scrollable class="childtwo">
                <div>
                    <paper-input label="User Name" value="{{username}}"></paper-input>
                </div>
                <div>
                    <paper-input label="First Name" value="{{userFirstName}}"></paper-input>
                </div>
                <div>
                    <paper-input label="Last Name" value="{{userLastName}}"></paper-input>
                </div>
                <div>
                    <paper-input label="Email" value="{{userEmail}}"></paper-input>
                </div>
                <div>
                    <label class="flex-child" style="font: inherit"> <h>Select Role :</h></label>
                    <select id=findUserRole style="font: inherit; margin-left:0.5em;">
                        <option>Select Role</option>
                        <option value="ADMIN">Admin</option>
                        <option value="ORG_ADMIN">Organization Admin</option>
                        <option value="REGISTERED">Registered</option>
                    </select>
                </div>
                <div class="flex-child">
                <label class="flex-child" style="font: inherit"> <h>Select Organization :</h></label>
                <select id=findUserOrganizationId style="font: inherit; margin-left:0.5em;">
                  <option>Select User</option>
                  <template is="dom-repeat" restamp="true" userOrganization={{item}} items="{{organizations}}">
                    <option value="{{item.id}}">{{item.name}}</option>
                  </template>
                </select>
              </div>
            </paper-dialog-scrollable>
            <div class="parenttwo">
                <paper-button raised class="child" on-tap="setAjaxAddUser">Save</paper-button>
                <paper-button raised class="child" on-tap="closeUser">Cancel</paper-button>
            </div>
        </paper-dialog>
        <paper-dialog id="addMeasure" class="size-position modalBox">
            <div>
                <h2>Add New Measure</h2>
            </div>
            <paper-dialog-scrollable class="childtwo">
                <div>
                    <paper-input required="true" label="NQF ID" value="{{nqfId}}"></paper-input>
                </div>
                <div>
                    <paper-input label="Name" value="{{measureName}}"></paper-input>
                </div>
                <div>
                    <paper-input label="Description" value="{{measureDescription}}"></paper-input>
                </div>
                <div>
                    <paper-input label="Numerator Description" value="{{numeratorDescription}}"></paper-input>
                </div>
                <div>
                    <paper-input label="Denominator Description" value="{{denominatorDescription}}"></paper-input>
                </div>
                <div>
                    <paper-input label="Exclusions Description" value="{{exclusionsDescription}}"></paper-input>
                </div>
            </paper-dialog-scrollable>
            <div class="parenttwo">
                <paper-button raised class="child" on-tap="setAjaxAddMeasure">Save</paper-button>
                <paper-button raised class="child" on-tap="closeMeasure">Cancel</paper-button>
            </div>
        </paper-dialog>
        <shape-iron-ajax-helper
            id="ajaxAddOrganization"
            resource="/common/organization/add"
            handle-as="json"
            method="POST"
            debounce-duration="300">
        </shape-iron-ajax-helper>
        <shape-iron-ajax-helper
            id="ajaxAddProvider"
            resource="/admin/provider/add"
            handle-as="json"
            method="POST"
            debounce-duration="300"
            on-response="addProviderCallback">
        </shape-iron-ajax-helper>
        <shape-iron-ajax-helper
          id="ajaxAddUser"
          resource=""
          body=""
          method="POST"
          handle-as="json"
          on-response="callBackAddUser"
          debounce-duration="300">
        <shape-iron-ajax-helper>
        <shape-iron-ajax-helper
          id="ajaxAddMeasure"
          resource=""
          body=""
          method="POST"
          handle-as="json"
          on-response="callBackAddMeasure"
          debounce-duration="300">
        <shape-iron-ajax-helper>
        <shape-iron-ajax-helper
          id="findOrgs"
          resource=""
          method="GET"
          handle-as="json"
          on-response="callBackOrgs"
          debounce-duration="300">
        </shape-iron-ajax-helper>
    </template>
</dom-module>
<script>
    (function () {
        Polymer({
            is: 'app-admin-add',
            properties: {

                name: String,
                id: Number,
                active: Boolean,
                addressStreet: String,
                addressCity: String,
                addressState: String,
                addressZip: String,
                primaryContactName: String,
                primaryContactRole: String,
                primaryContactEmail: String,
                primaryContactPhone: String

            },
            ready: function() {
              this.providerData = {};
            // this.firstName='firstName';
            // this.lastName='lastName';
            // this.NPI='NPI';
            // this.organization='organization';
            // this.name='name';
            // this.address='address';
            // this.username='username';
            // this.userFullName='userFullName';
            // this.userRole='userRole';
            // this.userOrganization='userOrganization';
            // this.nqfID='nqfID';
            // this.cmsID='cmsID';
            // this.measureName='measureName';
            },

            setAjaxAddUser: function () {
                console.log(this.$.findUserOrganizationId);
                this.$.ajaxAddUser.resource="/admin/create/user";
                this.$.ajaxAddUser.body = JSON.stringify ({
                      "id": this.username,
                      "role": this.$.findUserRole.value,
                      "password": "",
                      "organizationId":this.$.findUserOrganizationId.value,
                      "firstName": this.userFirstName,
                      "lastName": this.userLastName,
                      "email": this.userEmail
              });
                this.$.ajaxAddUser.method="POST";
                this.$.ajaxAddUser.callBack=this.callBackAddUser;
                this.$.ajaxAddUser.generateRequest();
                this.$.addUser.toggle();
              },

            callBackAddUser: function(request) {
              console.log(request);
              document.querySelector('app-admin-panel-user').setajax();
            },

            setAjaxAddMeasure: function () {
                this.$.ajaxAddMeasure.resource="/admin/measure/add";
                this.$.ajaxAddMeasure.body = JSON.stringify ({
                      "id": "",
                      "name": this.measureName,
                      "description": this.measureDescription,
                      "nqfId":this.nqfId,
                      "numeratorDescription": this.numeratorDescription,
                      "denominatorDescription": this.denominatorDescription,
                      "exclusionsDescription": this.exclusionsDescription,
                      "wellControlledNumerator" : "",
                      "selected": ""
              });
                this.$.ajaxAddMeasure.method="POST";
                this.$.ajaxAddMeasure.callBack=this.callBackAddUser;
                this.$.ajaxAddMeasure.generateRequest();
                this.$.addMeasure.toggle();
              },

            callBackAddMeasure: function(request) {
              console.log(request);
              document.querySelector('app-admin-panel-measure').setajax();
            },

            setajaxOrgs: function () {
              this.$.findOrgs.resource = "/admin/organization/findAll";
              this.$.findOrgs.callBack=this.callBackOrgs;
              this.$.findOrgs.generateRequest();
            },

            callBackOrgs: function(request) {
              console.log(request.detail.response);
              //console.log(this.organizations.length);
              //console.log(this.organizations.length);
              // var arrayLength= this.organizations.length;
              // for(var i = 0; i<arrayLength; i++){
              //    if (this.organizations[i].name == this.$.findUserOrganizationId.value){
              //      userOrganizationId= 'organizations.'+i+'.id';
              //    };
              //  };
              // console.log(userOrganizationId);
              this.organizations=request.detail.response;
            },

            addButton: function(inputModalName) {
                for (var i in this.providerData) {
                  this.set('providerData.' + i, '');
                }

                this.setajaxOrgs();

                if (inputModalName == 'addProvider') {
                this.$.addProvider.open();
                };

                if (inputModalName == 'addOrganization') {
                this.$.addOrganization.open();
                };

                if (inputModalName == 'addMeasure') {
                this.$.addMeasure.open();
                };

                if (inputModalName == 'addUser') {
                this.$.addUser.open();
                };
            },

            logProvider: function (e) {
                var selectChoice = this.$.providerOrgSelect.value;
                for (var org in this.organizations) {
                  if (this.organizations[org].name == selectChoice) {
                    var orgId = this.organizations[org].id;
                    break;
                  }
                }
                var newProviderData = {
                  name: this.providerData.name,
                  active: true,
                  npi: this.providerData.npi,
                  organizationId: orgId
                }
                this.$.ajaxAddProvider.body = JSON.stringify(newProviderData);
                this.$.ajaxAddProvider.generateRequest();

                this.$.addProvider.toggle();
            },

            closeProvider: function(e) {
                this.$.addProvider.toggle()
            },

            logOrganization: function (e) {
              this.$.ajaxAddOrganization.body = JSON.stringify({
                "id" : "",
                "name" : this.name,
                "addressStreet" : this.addressStreet,
                "addressCity" : this.addressCity,
                "addressState" : this.addressState,
                "addressZip" : this.addressZip,
                "primaryContactName" : this.primaryContactName,
                "primaryContactEmail" : this.primaryContactEmail,
                "primaryContactPhone" : this.primaryContactPhone,
                "primaryContactRole" : this.primaryContactRole,
                "active" : "false"
              });


              this.name = "";
              this.addressStreet = "";
              this.addressStreet = "";
              this.addressCity = "";
              this.addressState = "";
              this.addressZip = "";
              this.primaryContactName = "";
              this.primaryContactEmail = "";
              this.primaryContactPhone = "";
              this.primaryContactRole = "";
              this.$.ajaxAddOrganization.generateRequest();
              console.log(this.$.ajaxAddOrganization.body);
              this.$.addOrganization.close();
              document.querySelector('app-admin-panel').loadOrgTable();
            },
            // logOrganization: function (e) {
            //     var formSubmitOrganization = [
            //     {'name': this.name,
            //     'address': this.address,
            //     }];
            //     this.$.addOrganization.toggle(),
            //     console.log(formSubmitOrganization)
            // },

            closeOrganization: function(e) {
                this.$.addOrganization.toggle()
            },

            // logMeasure: function (e) {
            //     var formSubmitMeasure = [
            //     {'nqfID': this.nqfID,
            //     'cmsID': this.cmsID,
            //     'measureName': this.measureName
            //     }];
            //     this.$.addOrganization.toggle(),
            //     console.log(formSubmitMeasure)
            // },

            closeMeasure: function(e) {
                this.$.addMeasure.toggle()
            },

            // logUser: function (e) {
            //     var formSubmitUser = [
            //     {'username': this.username,
            //     'userFullName': this.userFullName,
            //     'userRole': this.userRole,
            //     'userOrganization': this.userOrganization
            //     }];
            //     this.$.addUser.toggle(),
            //     console.log(formSubmitUser)
            // },

            closeUser: function(e) {
                this.$.addUser.toggle()
            },

            // logMeasure: function () {
            //     var formSubmitMeasure = [
            //     {'nqfID': this.nqfID.value,
            //     'cmsID': this.cmsID.value,
            //     }];
            //     this.$.addMeasure.toggle(),
            //     console.log(formSubmitMeasure)
            // },

            addProviderCallback: function() {
              document.querySelector('app-admin-panel-provider').$.findProviders.generateRequest();
            }

        });
    })();
</script>
