<!-- <link rel="import" href="../../bower_components/polymer/polymer.html"> -->
<link rel="import" href="../elements.html">


<dom-module id="app-admin-edit">
    <style>
        .pms {
        @apply(--pm-style)
        }
        h2 {
          padding: 0px 40px 0px 40px;
        };
        paper-input {
          padding: 5px 20px 5px 20px;
        };
        .Username{
          font-weight: bold;
          color:grey;
        }

        select[selected] {
            border: none;
        }
        select {
            height: 2.5em;
            font-size: 1em;
            background: white;
            border: none;
        }
        select[focused] {
            border: none;
        }

    </style>
    <template>
        <paper-dialog id="editProvider" class="size-position modalBox">
            <div>
                <h2>Edit Provider Information</h2>
            </div>
            <div class="childtwo">
                <div>
                    <paper-input label="Name" value="{{providerData.name}}"></paper-input>
                </div>
                <div>
                    <paper-input label="NPI" value="{{providerData.npi}}"></paper-input>
                </div>
                <div>
                  <label><strong>Organization</strong>:
                    <select id="providerOrgSelect">
                      <template is="dom-repeat" items="{{organizations}}">
                          <option>{{item.name}}</option>
                      </template>
                    </select>
                  </label>
                </div>
            </div>
            <div class="parenttwo">
                <paper-button raised class="child" on-tap="logProvider">Save</paper-button>
                <paper-button raised class="child" on-tap="closeModal" modalName="closeProviderModal">Cancel</paper-button>
            </div>
        </paper-dialog>
        <paper-dialog id="editOrganization" class="size-position modalBox">
          <shape-iron-ajax-helper
              id="ajaxEditOrganization"
              resource="/admin/organization/edit"
              handle-as="json"
              method="POST"
              on-response="organizationCallBack"
              debounce-duration="300">
          </shape-iron-ajax-helper>

            <div>
                <h2>Edit Organization Information</h2>
            </div>
            <div class="childtwo">
                <div>
                    <paper-input label="Organization Name" value="{{organization.name}}"></paper-input>
                </div>
                <div>
                    <paper-input label="Street Address" value="{{organization.addressStreet}}"></paper-input>
                </div>
                <div>
                    <paper-input label="City" value="{{organization.addressCity}}"></paper-input>
                </div>
                <div>
                    <paper-input label="State" value="{{organization.addressState}}"></paper-input>
                </div>
                <div>
                    <paper-input label="Zip" value="{{organization.addressZip}}"></paper-input>
                </div>
                <div>
                    <paper-input label="Primary Contact Name" value="{{organization.primaryContactName}}"></paper-input>
                </div>
                <div>
                    <paper-input label="Primary Contact email" value="{{organization.primaryContactEmail}}"></paper-input>
                </div>
                <div>
                    <paper-input label="Primary Contact Phone" value="{{organization.primaryContactPhone}}"></paper-input>
                </div>
                <div>
                    <paper-input label="Primary Contact Role" value="{{organization.primaryContactRole}}"></paper-input>
                </div>
            </div>
                <div class="parenttwo">
                    <paper-button raised class="child" on-tap="logOrganization">Save</paper-button>
                    <paper-button raised class="child" on-tap="closeModal" modalName="closeOrgModal">Cancel</paper-button>
                </div>
        </paper-dialog>


        <paper-dialog id="editUser" class="size-position modalBox">
            <div>
                <h2>Edit User Information</h2>
            </div>
            <div class="childtwo">
                <div>
                <p class="Username">Username: <span>{{users.id}}</span></p>
                </div>
                <div>
                    <paper-input label="First Name" value="{{users.firstName}}"></paper-input>
                </div>
                <div>
                    <paper-input label="Last Name" value="{{users.lastName}}"></paper-input>
                </div>
                <div>
                    <select id=findUserRole style="font: inherit; margin-left:0.5em;">
                        <option select>Select Role</option>
                        <option value="ADMIN">Admin</option>
                        <option value="ORG_ADMIN">Organization Admin</option>
                        <option value="REGISTERED">Registered</option>
                    </select>
                </div>
                <!-- <select id=findUserOrganizationId style="font: inherit; margin-left:0.5em;">
                    <option select>Select Organization</option>
                  <template is="dom-repeat" restamp="true" userOrganization={{item}} items="{{organizations}}">
                    <option value="{{item.value}}">{{item.name}}</option>
                  </template>
                </select> -->
            </div>
            <div class="parenttwo">
                <paper-button raised class="child" on-tap="ajaxEditUser">Save</paper-button>
                <paper-button raised class="child" on-tap="closeModal" modalName="closeUserModal">Cancel</paper-button>
            </div>
        </paper-dialog>



        <paper-dialog id="editMeasure" class="size-position modalBox">
            <div>
                <h2>Edit Measure Information</h2>
            </div>
            <div class="childtwo">
              <div>
                  <paper-input required="true" label="NQF ID" value="{{measure.nqfId}}"></paper-input>
              </div>
              <div>
                  <paper-input label="Name" value="{{measure.name}}"></paper-input>
              </div>
              <div>
                  <paper-input label="Description" value="{{measure.description}}"></paper-input>
              </div>
              <div>
                  <paper-input label="Numerator Description" value="{{measure.numeratorDescription}}"></paper-input>
              </div>
              <div>
                  <paper-input label="Denominator Description" value="{{measure.denominatorDescription}}"></paper-input>
              </div>
              <div>
                  <paper-input label="Exclusions Description" value="{{measure.exclusionsDescription}}"></paper-input>
              </div>
            </div>
            <div class="parenttwo">
                <paper-button raised class="child" on-tap="logMeasure">Save</paper-button>
                <paper-button raised class="child" on-tap="closeModal" modalName="closeMeasureModal">Cancel</paper-button>
            </div>
        </paper-dialog>
        <shape-iron-ajax-helper
            id="findOrgs"
            resource="/admin/organization/findAll"
            method="GET"
            handle-as="json"
            on-response="setAllOrgs"
            debounce-duration="300">
        </shape-iron-ajax-helper>
        <shape-iron-ajax-helper
            id="ajaxEditMeasure"
            resource="/admin/measure/edit"
            handle-as="json"
            method="POST"
            on-response="measureCallBack"
            debounce-duration="300">
        </shape-iron-ajax-helper>
        <shape-iron-ajax-helper
            id="ajaxEditUser"
            resource="/admin/user/edit"
            handle-as="json"
            method="POST"
            on-response="userCallBack"
            debounce-duration="300">
        </shape-iron-ajax-helper>
        <shape-iron-ajax-helper
            id="findUser"
            resource=""
            handle-as="json"
            on-response="callBackUser"
            debounce-duration="300">
        </shape-iron-ajax-helper>
        <shape-iron-ajax-helper
            id="ajaxEditProvider"
            resource="/admin/provider/edit"
            handle-as="json"
            method="POST"
            debounce-duration="300"
            on-response="editProviderCallback">
        </shape-iron-ajax-helper>
    </template>
</dom-module>
<script>
    (function () {
        Polymer({
            is: 'app-admin-edit',
            properties: {
              username:{
                type: String
              },
              firstname:{
                type: String
              },
              lastname:{
                type: String
              },
              userrole:{
                type: String,
                  value: "ADMIN"
              },
              userorganization:{
                type: String
              },
            },
            ready: function() {
            },
            getData: function(){
                this.$.findOrgs.generateRequest()
            },
            setAllOrgs: function(request){
                this.organizations=request.detail.response;
            },

            editButton: function(inputModalName, data) {
                this.getData();
                if (inputModalName == 'editProvider') {
                  this.set('providerData', {});
                  for (var i in data) {
                    this.set('providerData.' + i, data[i]);
                  }
                  this.$.providerOrgSelect.value = data.organization;
                  console.log('providerData', this.providerData);

                  this.$.editProvider.open();
                }

                if (inputModalName == 'editOrganization') {
                  this.$.editOrganization.open();
                }

                if (inputModalName == 'editMeasure') {
                  this.$.editMeasure.open();
                }

                if (inputModalName == 'editUser') {

                  this.$.editUser.open();
                };
            },
            callback: function() {
              //refreshTableName = e.target.parentNode.getAttribute("id");
              // if (refreshTableName == ajaxEditOrganization){
              //   document.querySelector('app-admin-panel-organization').setajax();
              // }
              console.log("helloWorld");
            },

            closeModal: function(e) {
                closeModalName = e.target.parentNode.getAttribute("modalName");

                if (closeModalName == 'closeProviderModal') {
                    this.$.editProvider.close();
                };

                if (closeModalName == 'closeOrgModal') {
                    this.organization = {};
                    this.$.editOrganization.close();
                };

                if (closeModalName == 'closeMeasureModal') {
                    this.$.editMeasure.close();
                };

                if (closeModalName == 'closeUserModal') {
                    this.$.editUser.close();
                };
            },

            logProvider: function (e) {
              var selectChoice = this.$.providerOrgSelect.value;
              for (var org in this.organizations) {
                if (this.organizations[org].name == selectChoice) {
                  var orgId = this.organizations[org].id;
                  break;
                }
              }
              this.providerData.organizationId = orgId;
              this.providerData.organization = selectChoice;
              this.$.ajaxEditProvider.body = JSON.stringify({
                id: this.providerData.id,
                name: this.providerData.name,
                active: this.providerData.active,
                npi: this.providerData.npi,
                organizationId: this.providerData.organizationId
              });
              this.$.ajaxEditProvider.generateRequest();

              var providerPanel = document.querySelector('app-admin-panel-provider');
              for (var providerIndex in providerPanel.providers) {
                if (providerPanel.providers[providerIndex].id == this.providerData.id) {
                  break;
                }
              }
              providerPanel.set('providers.' + providerIndex, Object.create(this.providerData));

              this.$.editProvider.toggle();

            },
            logOrganization: function (e) {
                this.$.ajaxEditOrganization.body = JSON.stringify({
                  "id" : this.organization.id,
                  "name" : this.organization.name,
                  "addressStreet" : this.organization.addressStreet,
                  "addressCity" : this.organization.addressCity,
                  "addressState" : this.organization.addressState,
                  "addressZip" : this.organization.addressZip,
                  "primaryContactName" : this.organization.primaryContactName,
                  "primaryContactEmail" : this.organization.primaryContactEmail,
                  "primaryContactPhone" : this.organization.primaryContactPhone,
                  "primaryContactRole" : this.organization.primaryContactRole,
                  "modifiedDt" : "",
                  "modifiedBy" : app.$.loginPage.$.userIdInput.value,
                  "createdBy"  : this.organization.createdBy
                });
                this.$.ajaxEditOrganization.generateRequest();
                console.log(this.$.ajaxEditOrganization.body);
                document.querySelector('app-admin-panel').loadOrgTable();
                this.$.editOrganization.close();

            },
            organizationCallBack: function(){
                this.$.editOrganization.close();
                document.querySelector('app-admin-panel-organization').setajax();
            },

            ajaxFindUsers: function() {
              userLoginId=document.getElementById('userIdInput').value;
              this.$.findUser.resource = "/admin/user/find/" + userLoginId;
              this.$.findUser.callBack = this.callBackUser;
              this.$.findUser.generateRequest();
            },

           callBackUser: function(request) {
             console.log(request.detail.response);
             console.log(request.detail.response.organizationId);
             userOrganizationId=request.detail.response.organizationId;
             console.log(userOrganizationId);
          },

            ajaxEditUser: function (e) {
                editUserPassword=document.getElementById('passwordInput').value;
                this.$.ajaxEditUser.body = JSON.stringify({
                  "id" : this.users.id,
                  "admin" : this.users.admin,
                  "active" : this.users.active,
                  "resetPwd" : this.users.resetPwd,
                  "modifiedDt" : "",
                  "modifiedBy" : app.$.loginPage.$.userIdInput.value,
                  "role" : this.$.findUserRole.value,
                  "organizationId" : this.users.organizationId,
                  "firstName" : this.users.firstName,
                  "lastName" : this.users.lastName,
                  "email" : this.users.email
                });
                this.$.ajaxEditUser.generateRequest();
                document.querySelector('app-admin-panel').loadTable();
                this.$.editUser.close();
              },
            userCallBack: function(){
                //this.$.editOrganization.close();
                document.querySelector('app-admin-panel').loadTable();
            },

            ajaxEditMeasure: function (e) {
                this.$.ajaxEditMeasure.body = JSON.stringify({
                  "id": this.measure.id,
                  "name": this.measure.name,
                  "description": this.measure.description,
                  "nqfId":this.measure.nqfId,
                  "numeratorDescription": this.measure.numeratorDescription,
                  "denominatorDescription": this.measure.denominatorDescription,
                  "exclusionsDescription": this.measure.exclusionsDescription,
                  "wellControlledNumerator" : "",
                  "selected": ""
                });
                this.$.ajaxEditMeasure.generateRequest();
                this.$.editMeasure.close();
              },
            measureCallBack: function(){
              document.querySelector('app-admin-panel').loadMeasureTable();
            },
            editProviderCallback: function() {
              document.querySelector('app-admin-panel-provider').$.findProviders.generateRequest();
            }
        });
    })();
</script>
